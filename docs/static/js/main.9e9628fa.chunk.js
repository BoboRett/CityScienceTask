(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{26:function(e,t,a){},29:function(e,t,a){e.exports=a(82)},34:function(e,t,a){},65:function(e,t,a){},66:function(e,t,a){},67:function(e,t,a){},80:function(e,t,a){},81:function(e,t,a){},82:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(18),i=a.n(c),l=(a(34),a(3)),o=a(12),s=a(13),u=a.n(s),d=a(28),h=a.n(d),m=a(2),f=function(e){var t=Object(n.useState)(null),a=Object(l.a)(t,2),r=a[0],c=a[1];Object(n.useEffect)(function(){if(e){m.p('.StackedBar > .Data > g > rect:not([class="'.concat(e,'"])')).transition("fadehovered").duration(100).attr("opacity",.2);var t=m.p('.StackedBar > .Data > g > rect[class="'.concat(e,'"]')).datum().data.data.CP.marker._element.children[0];c(t),m.o(t).transition().duration(200).attr("transform","translate( 0, -8.75 )scale( 1.5 )")}else m.p(".StackedBar > .Data > g > rect").transition("fadehovered").duration(50).attr("opacity",1),m.o(r).transition().attr("transform","translate( 0, 0 )scale( 1 )")},[e])},p=function(e,t,a,n){var r=new u.a.LngLat(e.lng,e.lat),c=(new u.a.Popup).setHTML('\n                <div class="MapPopup">\n                    <h1>'.concat(e.road_name,"</h1>\n                    <h2>").concat(e.displayName,'</h2>\n                    <button id="focus">\n                        Set Focus\n                    </button>\n                </div>\n            '));c._content.querySelector("#focus").addEventListener("click",function(){return n({type:"setFilter",payload:{id:e.id}})});var i=(new u.a.Marker).setLngLat(r).setPopup(c).addTo(t);i.data=e,e.marker=i,t.markers.push(i),m.o(i.getElement()).select("svg").append("rect").attr("x",0).attr("y",0).attr("width","100%").attr("height","100%").attr("fill","#0000").on("mouseenter",function(){n({type:"setHoveredCP",payload:e.id})}).on("mouseout",function(){n("clearHoveredCP")}),a.extend(r)},v=a(11),g=a(4),y=a(6),_=function(e){var t={};return e.forEach(function(e){t[e.count_point_id]||(t[e.count_point_id]=new w({road_name:e.road_name,id:e.count_point_id,road_type:e.road_type,lat:+e.latitude,lng:+e.longitude,region_id:e.region_id,authority_id:e.local_authority_id,link_length:e.link_length_km,start_junction:e.start_junction_road_name,end_junction:e.end_junction_road_name}));var a={sum_vehicles:+e.all_motor_vehicles+ +e.pedal_cycles,sum_goods:+e.all_hgvs+ +e.lgvs,sum_hgvs:e.all_hgvs,sum_bus_coach:e.buses_and_coaches,sum_cars_taxis:e.cars_and_taxis,sum_lgvs:e.lgvs,sum_hgv_2_rigid:e.hgvs_2_rigid_axle,sum_hgv_3_artic:e.hgvs_3_or_4_articulated_axle,sum_hgv_3_rigid:e.hgvs_3_rigid_axle,sum_hgv_4_rigid:e.hgvs_4_or_more_rigid_axle,sum_hgv_5_artic:e.hgvs_5_articulated_axle,sum_hgv_6_artic:e.hgvs_6_articulated_axle,sum_push:e.pedal_cycles,sum_motorbike:e.two_wheeled_motor_vehicles},n=t[e.count_point_id].counts[e.year]||new j(t[e.count_point_id],e.year,e.estimation_method,e.direction_of_travel);t[e.count_point_id].counts[e.year]=n,n.addDirection(e.direction_of_travel,a)}),t=Object.values(t)},E=function(e,t){return e.filter(function(e){return e.matchesFilters(t)})},b=function(e,t){var a=Object.values(e.counts);return t.year&&(a=a.filter(function(e){return e.year===t.year})),a.reduce(function(e,a){return e.addCounts(t.direction||"Total",a.vehicles.getCounts(t.direction))},new k(e))},x=function(e,t){e=e.toString(),t=t.toString();var a=/[^a-zA-Z]/g,n=/[^0-9]/g,r=e.replace(a,""),c=t.replace(a,"");if(r===c){var i=parseInt(e.replace(n,""),10),l=parseInt(t.replace(n,""),10);return i===l?0:i>l?1:-1}return r>c?1:-1},w=function(){function e(t){var a=t.road_name,n=t.id,r=t.road_type,c=t.lat,i=t.lng,l=t.region_id,o=t.authority_id,s=t.link_length,u=t.start_junction,d=t.end_junction;Object(g.a)(this,e),this.road_name=a,this.id=n.toString(),this.road_type=r,this.lat=c,this.lng=i,this.region_id=l.toString(),this.authority_id=o.toString(),this.link_length=s,this.start_junction=u,this.end_junction=d,this.displayName=u?d+"_"+u:this.id,this.counts={}}return Object(y.a)(e,[{key:"matchesFilters",value:function(e){var t=this;return(!(Object.keys(e).length>0)||Object.entries(e).filter(function(e){return t.hasOwnProperty(e[0])}).every(function(e){var a=Object(l.a)(e,2),n=a[0],r=a[1];return t[n]===r}))&&(!e.distance||function(e,t){var a=function(e){return e*Math.PI/180},n=a(e[1]),r=a(t[1]),c=a(t[1]-e[1]),i=a(t[0]-e[0]),l=Math.pow(Math.sin(c/2),2)+Math.cos(n)*Math.cos(r)*Math.pow(Math.sin(i/2),2);return 2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))*6371e3}(e.distance.center,[this.lng,this.lat])<1e3*e.distance.radius)}}]),e}(),j=function(){function e(t,a,n){Object(g.a)(this,e),this.parent=t,this.year=a.toString(),this.isEstimated="Estimated"===n,this.vehicles=new k(this)}return Object(y.a)(e,[{key:"addDirection",value:function(e,t){return this.vehicles.addCounts(e,t),this}}]),e}(),O=function(){function e(t,a){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object(g.a)(this,e),this.name=t,this.values={},this.subcounts=n,this.CP=a}return Object(y.a)(e,[{key:"addValue",value:function(e,t){return this.values[e]=this.values[e]?this.values[e]+t:t,this}},{key:"flatten",value:function(){return Object(o.a)({},this.subcounts,this.children.reduce(function(e,t){return Object(o.a)({},e,t.flatten())},{}))}},{key:"children",get:function(){return Object.values(this.subcounts)}},{key:"total",get:function(){return Object.values(this.values).reduce(function(e,t){return e+t},0)}}]),e}(),k=function(){function e(t){var a=this;Object(g.a)(this,e);var n=new O("Total Vehicles",t,{sum_goods:new O("Goods",t,{sum_hgvs:new O("HGVs",t,{sum_hgv_6_artic:new O("Six-axle Artic",t),sum_hgv_5_artic:new O("Five-axle Artic",t),sum_hgv_4_rigid:new O("Four-axle Rigid",t),sum_hgv_3_rigid:new O("Three-axle Rigid",t),sum_hgv_3_artic:new O("Three-axle Artic",t),sum_hgv_2_rigid:new O("Two-axle Rigid",t)}),sum_lgvs:new O("LGVs",t)}),sum_push:new O("Pedal Cycles",t),sum_motorbike:new O("Motorbikes",t),sum_bus_coach:new O("Buses and Coaches",t),sum_cars_taxis:new O("Cars and Taxis",t)});Object.entries(Object(o.a)({sum_vehicles:n},n.flatten())).forEach(function(e){var t=Object(l.a)(e,2),n=t[0],r=t[1];return a[n]=r})}return Object(y.a)(e,[{key:"getCounts",value:function(e){return Object.entries(this).reduce(function(t,a){var n=Object(l.a)(a,2),r=n[0],c=n[1];return Object(o.a)({},t,Object(v.a)({},r,e?c.values[e]||0:c.total))},{})}},{key:"addCounts",value:function(e,t){return Object.entries(this).forEach(function(a){var n=Object(l.a)(a,2),r=n[0],c=n[1];return t[r]&&c.addValue(e,+t[r])}),this}},{key:"hierarchy",get:function(){return m.i(this.sum_vehicles).each(function(e){return e.data.hierarchy=e})}}]),e}(),M=(a(65),function(e){var t=e.children,a=e.id;return r.a.createElement("div",{className:"component-filterHolder",id:a},r.a.createElement("div",null,r.a.createElement("svg",{viewBox:"0 0 100 100"},r.a.createElement("g",{style:{transform:"translate(50%,50%)"}},r.a.createElement("path",{d:"M -7 -10 l -30 -30 h 74 l -30 30 l -5 45 l -6 5 Z"}))),r.a.createElement("h1",null,"Filters")),t)}),D=function(e){var t=e.data,a=e.map,n=e.display,c=e.setDisplay,i=function(e){return t?Array.from(new Set(t.map(function(t){return t[e]}))).sort(x):["NO DATA"]};return r.a.createElement(M,{id:"countPointFilters"},r.a.createElement(N,{title:"Count Point",id:"id",options:i("id"),filters:n.filters,setDisplay:c},r.a.createElement("path",{id:"icon_marker",d:"M -25 0 a 30 30 0 1 1 50 0 l -25 40 l -25 -40 M -12.5 -15 a 12.5 12.5 0 0 0 25 0 a 12.5 12.5 0 0 0 -25 0"})),r.a.createElement(A,{filters:n.filters,map:a,setDisplay:c},r.a.createElement("path",{id:"icon_marker",d:"M -25 0 a 30 30 0 1 1 50 0 l -25 40 l -25 -40 M -12.5 -15 a 12.5 12.5 0 0 0 25 0 a 12.5 12.5 0 0 0 -25 0",transform:"translate(-15)"}),r.a.createElement("line",{x1:"-15",x2:"25",y1:"40",y2:"10",strokeWidth:"5",strokeDasharray:"6"}),r.a.createElement("use",{href:"#icon_marker",transform:"translate(25,-10)scale(0.6)",opacity:"0.6"})),r.a.createElement(N,{title:"Road Name",id:"road_name",options:i("road_name"),filters:n.filters,setDisplay:c},r.a.createElement("line",{x1:"-20",x2:"-20",y1:"35",y2:"15",strokeWidth:"5"}),r.a.createElement("line",{x1:"20",x2:"20",y1:"35",y2:"15",strokeWidth:"5"}),r.a.createElement("rect",{x:"-40",y:"-35",width:"80",height:"50"}),r.a.createElement("text",{x:"0",y:"2"},"A66")),r.a.createElement(N,{title:"Road Type",id:"road_type",options:i("road_type"),filters:n.filters,setDisplay:c},r.a.createElement("path",{d:"M -10 -40 h 7 l -1 20 h -8 Z"}),r.a.createElement("path",{d:"M 10 -40 h -7 l 1 20 h 8 Z"}),r.a.createElement("path",{d:"M -13 0 h 9 l -2 40 h -11 Z"}),r.a.createElement("path",{d:"M 13 0 h -9 l 2 40 h 11 Z"}),r.a.createElement("path",{d:"M -40 -15 h 80 v 10 h -7 q -3 0 -3 3 v 7 h -7 l -3 -7 q 0 -3 -3 -3 h -34 q -3 0 -3 3 l -3 7 h -7 v -7 q 0 -3 -3 -3 h -7 v -10"})))},C=function(e){var t=e.showDate,a=void 0===t||t,c=e.showDirection,i=void 0===c||c,l=(e.data,e.display),o=e.setDisplay,s=Object(n.useCallback)(r.a.createElement(N,{title:"Year",id:"year",options:Array.from({length:19},function(e,t){return(2e3+t).toString()}),filters:l.filters,setDisplay:o},r.a.createElement("path",{d:"M -30 -30 q -10 0 -10 10 v 50 q 0 10 10 10 h 60 q 10 0 10 -10 v -50 q 0 -10 -10 -10 h -5 a 10 10 0 0 0 -20 0 h -10 a 10 10 0 0 0 -20 0 h -5\n                      M -29 -14 h  13 v  12 h -13 v -12\n                      M -14 -14 h  13 v  12 h -13 v -12\n                      M  1  -14 h  13 v  12 h -13 v -12\n                      M  16 -14 h  13 v  12 h -13 v -12\n                      M -29  2  h  13 v  12 h -13 v -12\n                      M -14  2  h  13 v  12 h -13 v -12\n                      M  1   2  h  13 v  12 h -13 v -12\n                      M  16  2  h  13 v  12 h -13 v -12\n                      M -29  18 h  13 v  12 h -13 v -12\n                      M -14  18 h  13 v  12 h -13 v -12"})),[l.filters,o]),u=Object(n.useCallback)(r.a.createElement(N,{title:"Direction",id:"direction",options:["N","S","E","W"],filters:l.filters,setDisplay:o},r.a.createElement("path",{d:"M -45 0 a 45 45 0 0 0 90 0 a 45 45 0 0 0 -90 0 M 35 0 a 35 35 0 0 1 -70 0 a 35 35 0 0 1 70 0"}),r.a.createElement("path",{d:"M 0 34 l -10 -32 a 20 20 0 0 0 20 0 l -10 32",transform:"rotate(20)"}),r.a.createElement("path",{d:"M 0 34 l -10 -32 a 20 20 0 0 0 20 0 l -10 32",transform:"rotate(200)"})),[l.filters,o]);return r.a.createElement(M,{id:"countFilters"},a?s:null,i?u:null)},N=function(e){var t=e.children,a=e.title,n=e.id,c=e.options,i=e.filters,l=e.setDisplay,o=i.hasOwnProperty(n),s=function(e){l(o?{type:"addFilter",payload:[n,e]}:{type:"removeFilter",payload:n})};return r.a.createElement("div",{className:"component-filterDropdown".concat(o?" active":"")},r.a.createElement("div",{className:"header",onClick:function(){o=!o,s(c[0])}},r.a.createElement("svg",{viewBox:"0 0 100 100"},r.a.createElement("g",{style:{transform:"translate(50%,50%)"}},t))),r.a.createElement("select",{onChange:function(e){return s(e.target.value)},value:i[n]||""},c.map(function(e){return r.a.createElement("option",{key:e,value:e},e)})),r.a.createElement("div",{className:"header_text",onClick:function(){o=!o,s(c[0])}},r.a.createElement("h1",{className:"title"},a),r.a.createElement("h1",{className:"currentFilter"},i[n])))},A=function(e){var t=e.children,a=e.map,c=e.filters,i=e.setDisplay,s=c.hasOwnProperty("distance"),d=Object(n.useRef)(null),m=Object(n.useRef)(null),f=function(e,t,a,r,c){var i=Object(n.useState)(null),s=Object(l.a)(i,2),d=s[0],m=s[1];return Object(n.useEffect)(function(){if(t&&e){var n=new h.a({accessToken:a,mapboxgl:u.a,clearAndBlurOnEsc:!1});t.current.appendChild(n.onAdd(e)),m(n),n.on("result",function(e){return r({type:"addFilter",payload:["distance",Object(o.a)({},e.result,{radius:c.current.value})]})}),n.on("clear",function(e){return r({type:"removeFilter",payload:"distance"})})}},[e,t,c,a,r]),d}(a,d,"pk.eyJ1IjoianJpZGxleTI0NiIsImEiOiJjanhpMzYxdXcxbWliNDFsN2g2bGg3ODg2In0.qqSDB24vCq0mdKUCdY4zgw",i,m),p=function(e){s?i({type:"addFilter",payload:["distance",c.distance?Object(o.a)({},c.distance,{radius:e}):null]}):f.clear()};return r.a.createElement("div",{className:"component-geoCoder".concat(s?" active":"")},r.a.createElement("div",{className:"header",onClick:function(){s=!s,p(5)}},r.a.createElement("svg",{viewBox:"0 0 100 100"},r.a.createElement("g",{style:{transform:"translate(50%,50%)"}},t))),r.a.createElement("div",{className:"geoCoder",ref:d},r.a.createElement("select",{ref:m,onChange:function(e){return p(e.target.value)},value:c.distance?c.distance.radius:"5"},r.a.createElement("option",{value:"5"},"<5km"),r.a.createElement("option",{value:"10"},"<10km"),r.a.createElement("option",{value:"15"},"<15km"))),r.a.createElement("div",{className:"header_text",onClick:function(){s=!s,p(5)}},r.a.createElement("h1",{className:"title"},"Distance"),r.a.createElement("h1",{className:"currentFilter"},c.distance?c.distance.text:"")))},L=(a(66),function(e){e.children;var t=e.data,a=e.filteredData,c=e.display,i=e.setDisplay,o=Object(n.useState)(null),s=Object(l.a)(o,2),d=s[0],h=s[1],m=Object(n.useRef)(null),f=function(e){var t=e.accessToken,a=e.mapRef,r=Object(n.useState)(null),c=Object(l.a)(r,2),i=c[0],o=c[1];return Object(n.useEffect)(function(){if(a.current){u.a.accessToken=t;var e=new u.a.Map({container:a.current,style:"mapbox://styles/jridley246/cjxi67z0i42vy1cldfj812u8x"});o(e),e.addControl(new u.a.NavigationControl,"bottom-left"),e.markers=[]}},[t,a]),i}({accessToken:"pk.eyJ1IjoianJpZGxleTI0NiIsImEiOiJjanhpMzYxdXcxbWliNDFsN2g2bGg3ODg2In0.qqSDB24vCq0mdKUCdY4zgw",mapRef:m});return function(e,t,a,r){Object(n.useEffect)(function(){if(e&&t){var a=new u.a.LngLatBounds;e.markers.filter(function(e){return!t.includes(e.data)}).forEach(function(e){e.data.marker=null,e.remove()}),e.markers=e.markers.filter(function(e){return t.includes(e.data)}),t.forEach(function(t){return!t.marker&&p(t,e,a,r)}),a._ne&&e.fitBounds(a,{padding:{left:50,top:50,bottom:50,right:400},duration:1e3})}},[e,t,r])}(f,d,0,i),Object(n.useEffect)(function(){a&&h(a)},[a,c.filters]),r.a.createElement("div",{className:"Mapbox",ref:m},r.a.createElement(D,{data:t,map:f,display:c,setDisplay:i}))}),S=a(10),q=function(e){e.transition("fade").duration(50).attr("opacity",1)},B=function(e){e.transition("fade").duration(100).attr("opacity",.2)},F=function(e){m.p('.Graph .Data > *:not([class="'.concat(e.key,'"])')).call(B),m.p('.Graph .Legend > g:not([id="'.concat(e.key,'"])')).call(B)},P=function(){m.p(".Graph .Data > *, .Graph .Legend > g").call(q)},T=function(e,t){m.o('[class="'.concat(e.label,'"]')).each(function(e,a){m.o(this).on(t).apply(this,[e,a])})},I=["#527243","#E6BD40","#4B8783","#CF8576","#C1C4E3","#A078F4"],G=function(e,t){t.title;var a=t.seriesLabels,n=function(e){e.attr("x",100).attr("opacity",0).transition("fade").duration(200).attr("x",0).attr("opacity",1)},r=function(e){return T(e,"mousemove")},c=function(e){return T(e,"mouseout")},i=function(e){return T(e,"click")},l=function(e){return T(e,"contextmenu")};e.selectAll("g").data(a,function(e){return e.label}).join(function(e){var t=e.append("g").attr("class","legend_entry").attr("id",function(e){return e.label}).attr("transform",function(e,t){return"translate( 0, ".concat(25*t," )")}).on("mousemove",r).on("mouseout",c).on("click",i).on("contextmenu",l);t.append("circle").attr("cx","-12").attr("cy",-6).attr("r",10).attr("fill",function(e){return e.colour}).call(n),t.append("text").text(function(e){return e.label}).attr("fill",function(e){return e.colour}).call(n)})},H=function(e,t,a,n,r){a&&e.select(".LeftAxis").transition().call(m.c(a).tickSize(-600)),t&&e.select(".BottomAxis").transition().call(m.b(t).tickPadding([0]).tickSizeOuter([0]).tickFormat(m.h("d"))),e.select(".BottomAxis").selectAll("text").attr("y",0).attr("dx",-9).on("mouseover",function(e,a){return n&&r({type:"setHoveredCP",payload:t.domain()[a]})}).on("mouseout",function(e,t){return n&&r("clearHoveredCP")}),e.select(".BottomAxis").selectAll(".tick > text").attr("transform","rotate(-45)")},R=function(e){var t,a,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:m.r;return 0===e.length?{stackedData:[],subgroups:[],colour:function(){}}:(e[0].children?(t=e[0].children.map(function(e){return e.data.name}),a=m.q().keys(t).offset(r).value(function(e,t){return e.children.find(function(e){return e.data.name===t}).data.total})):(t=[e[0].data.name],a=m.q().keys(t).offset(r).value(function(e,t){return e.data.total})),n=m.n().domain(t).range(I),{stackedData:a(e),subgroups:t,colour:n})},Z=function(e,t,a,n,r){var c=Object(l.a)(a,2),i=c[0],o=c[1],s=r.barLabels,u=r.graphData,d=r.lastIndex,h=function(e){m.g.preventDefault(),u[0].parent&&n({type:"setView",payload:["ascent",u[0].parent.data.name]})};e.select(".BG").on("contextmenu click",h);var f=R(u),p=f.stackedData,v=f.subgroups,g=f.colour,y=Math.max.apply(Math,Object(S.a)(u.map(function(e){return e.data.total}))),_=m.l().domain(s).range([t.left,t.width+t.left]).padding([.2]),E=m.m().domain([0,y]).range([t.height+t.top,t.top]).nice(),b=[];e.select(".Data").selectAll("g").data(p,function(e){return e.key}).join(function(e){return e.append("g").attr("class",function(e){return e.key}).attr("fill",function(e){return g(e.key)})},function(e){return e},function(e){"descent"===i&&e.filter(function(e,t){return t===d}).selectAll("rect").each(function(){b.push([+m.o(this).attr("y"),+m.o(this).attr("height")])}),e.remove()}).on("mousemove",F).on("mouseout",P).on("click",function(e){e[0].data.children&&n({type:"setView",payload:["descent",e.key]})}).on("contextmenu",h).selectAll("rect").data(function(e){return e}).join(function(e){return e=e.append("rect"),"descent"===i&&b[0]?e.each(function(e,t){var a=Math.max.apply(Math,Object(S.a)(p.map(function(e){return e[t][1]}))),n=m.m().domain([0,a]).range([b[t][0]+b[t][1],b[t][0]]);m.o(this).attr("y",n(e[1])).attr("height",n(e[0])-n(e[1]))}):e.attr("y",function(e){return E(e[1])}).attr("height",0),e}).attr("class",function(e,t){return e.data.data.CP.id}).attr("x",function(e,t){return _(s[t])}).attr("width",_.bandwidth()).transition("rectUpdate").duration(500).attr("y",function(e){return E(e[1])}).attr("height",function(e){return E(e[0])-E(e[1])}),G(e.select(".Legend"),{title:o,seriesLabels:v.map(function(e,t){return{label:e,colour:g(e)}}).reverse()}),H(e.select(".Axes"),_,E,!0,n)},V=function(e,t,a,n,r){var c=Object(l.a)(a,2),i=(c[0],c[1],r.xLabels),o=r.graphData,s=(r.lastIndex,function(e){m.g.preventDefault(),o[0].parent&&n({type:"setView",payload:["ascent",o[0].parent.data.name]})});e.select(".BG").on("contextmenu click",s);var u=R(o),d=u.stackedData,h=u.subgroups,f=u.colour,p=Math.max.apply(Math,Object(S.a)(o.map(function(e){return e.data.total}))),v=m.m().domain([2e3,2018]).range([t.left,t.width+t.left]);v.clamp(!0);var g=m.m().domain([0,p]).nice().range([t.height+t.top,t.top]);e.on("mousemove.cursor",function(){var t=Math.round(v.invert(m.k(this)[0])),a=o[0].children?o[t-2e3].children.map(function(e){return e.data.total}):[o[t-2e3].data.total];e.select(".Cursor > line").attr("x1",v(t)).attr("x2",v(t)),e.select(".Cursor_title").text(t),e.select(".Cursor > g").selectAll("text").data(h).join("text").attr("y",function(e,t){return 25*t}).text(function(e,t){return e+": "+a[t]})}),e.select(".Data").selectAll("path").data(d,function(e){return e.key}).join(function(e){return e.append("path").attr("class",function(e){return e.key}).style("fill",function(e){return f(e.key)})}).on("mousemove",F).on("mouseout",P).on("click",function(e){e[0].data.children&&n({type:"setView",payload:["descent",e.key]})}).on("contextmenu",s).transition().duration(500).attr("d",m.a().curve(m.e).x(function(e,t){return v(i[t])}).y0(function(e){return g(e[0])}).y1(function(e){return g(e[1])})),H(e.select(".Axes"),v,g),G(e.select(".Legend"),{title:"",seriesLabels:h.map(function(e,t){return{label:e,colour:f(e)}}).reverse()})};a(26);function Y(e){var t=e.children,a=e.data,c=e.display,i=e.setDisplay,o=Object(n.useRef)(null),s=Object(n.useState)(!1),u=Object(l.a)(s,2),d=u[0],h=u[1],f=Object(n.useMemo)(function(){return{top:20,left:110,height:360,width:590}},[]);return Object(n.useEffect)(function(){if(a){var e=m.o(o.current);h(a.length>25),a.length>25?e.selectAll(".StackedBar > .Data > g").remove():Z(e,f,c.view,i,a.reduce(function(e,t){var a=b(t,c.filters).hierarchy.descendants().find(function(e){return e.data.name===c.view[1]});return e.barLabels.push(t.id),e.graphData.push(a),e.lastIndex=void 0===e.lastIndex?a.parent?a.parent.children.indexOf(a):0:e.lastIndex,e},{barLabels:[],graphData:[],lastIndex:void 0}))}},[a,c.filters,c.view,f,i]),r.a.createElement("div",{className:"Graph HierarchicalGraph"},r.a.createElement("div",{className:"OverloadWarning".concat(d?" overload":"")},r.a.createElement("p",null,"Phew, that's a lot of data...",a?a.length:0," Count Points to be exact!",r.a.createElement("br",null),"Try applying more filters")),t,r.a.createElement("svg",{className:"StackedBar",viewBox:"0 0 900 500",preserveAspectRatio:"xMidYMid",ref:o},r.a.createElement("rect",{className:"BG",x:"0",y:"0",width:"100%",height:"100%",fill:"#0000"}),r.a.createElement("text",{className:"Title",transform:"translate(".concat(f.left+f.width/2,")")},"Filtered Count Points Overview"),r.a.createElement("g",{className:"Legend",transform:"translate( ".concat(f.left+f.width+40,", 100 )")}),r.a.createElement("g",{className:"Axes"},r.a.createElement("text",{transform:"translate(25,".concat(f.top+f.height/2,")rotate(-90)")},"Total Vehicles"),r.a.createElement("text",{transform:"translate(".concat(f.left+f.width/2,",").concat(f.top+f.height+80,")")},"Count Point ID"),r.a.createElement("g",{className:"LeftAxis",transform:"translate( ".concat(f.left,", 0 )")}),r.a.createElement("g",{className:"BottomAxis",transform:"translate( 0, ".concat(f.height+f.top," )")})),r.a.createElement("g",{className:"Data"})))}function W(e){var t=e.children,a=e.data,c=e.display,i=e.setDisplay,l=Object(n.useRef)(null),o=Object(n.useMemo)(function(){return{top:20,left:110,width:590,height:360}},[]);return Object(n.useEffect)(function(){if(a){var e=m.o(l.current),t=Array.from({length:19},function(e,t){return 2e3+t}),n=t.map(function(e){return a.reduce(function(t,a){return t.addCounts("Total",b(a,{year:e.toString(),direction:c.filters.direction}).getCounts())},new k).hierarchy.descendants().find(function(e){return e.data.name===c.view[1]})});V(e,o,c.view,i,{xLabels:t,graphData:n,lastIndex:n.parent?n.parent.children.indexOf(n):0})}},[a,c.filters.direction,c.view,o,i]),r.a.createElement("div",{className:"Graph AreaGraph"},t,r.a.createElement("svg",{className:"StackedArea",viewBox:"0 0 900 500",preserveAspectRatio:"xMidYMid",ref:l},r.a.createElement("rect",{className:"BG",x:"0",y:"0",width:"100%",height:"100%",fill:"#0000"}),r.a.createElement("text",{className:"Title",transform:"translate(".concat(o.left+o.width/2,")")},"Filtered Count Points over Time"),r.a.createElement("g",{className:"Legend",transform:"translate( ".concat(o.left+o.width+40,", 100 )")}),r.a.createElement("g",{className:"Axes"},r.a.createElement("text",{transform:"translate(22,".concat(o.top+o.height/2,")rotate(-90)")},"Total Vehicles"),r.a.createElement("text",{transform:"translate(".concat(o.left+o.width/2,",").concat(o.top+o.height+80,")")},"Year"),r.a.createElement("g",{className:"LeftAxis",transform:"translate( ".concat(o.left,", 0 )")}),r.a.createElement("g",{className:"BottomAxis",transform:"translate( 0, ".concat(o.height+o.top," )")})),r.a.createElement("g",{className:"Data"}),r.a.createElement("g",{className:"Cursor"},r.a.createElement("line",{x1:o.left,x2:o.left,y1:o.top,y2:o.top+o.height}),r.a.createElement("text",{className:"Cursor_title",transform:"translate( ".concat(o.left+o.width+20,", 275 )")}),r.a.createElement("g",{transform:"translate( ".concat(o.left+o.width+20,", 300 )")}))))}var z=a(20),J=a(19),U=(a(67),function(e){var t=e.children;return r.a.createElement("div",{className:"component-AppSidebar"},t)}),K=function(e){var t=e.children,a=e.helpText,c=Object(n.useState)(!1),i=Object(l.a)(c,2),o=i[0],s=i[1],u=Object(n.useState)(!1),d=Object(l.a)(u,2),h=d[0],m=d[1];return r.a.createElement("div",{className:"component-AppFrame".concat(o?" fullscreen":"")},r.a.createElement("div",{id:"layoutPlaceholder",style:{width:"100%",height:"100%"}}),r.a.createElement("div",{className:"App_frame_children"},t),r.a.createElement("div",{className:"Help".concat(h?" visible":"")},r.a.createElement("p",null,a)),r.a.createElement(X,{maximised:o,setMaximised:s}),r.a.createElement($,{showHelp:h,setShowHelp:m}))},X=function(e){var t=e.maximised,a=e.setMaximised,c=Object(n.useState)(0),i=Object(l.a)(c,2),o=i[0],s=i[1],u=Object(n.useRef)(null),d=Object(J.a)({onHover:function(e){var t=e.hovering;s(t?1:0)},onDragStart:function(){return a(!t)}}),h=Object(n.useCallback)(m.j("M -10 0 L 0 0 L 0 10 M 0 10 L 0 0 L 10 0 M 10 0 L 0 0 L 0 -10 M 0 -10 L 0 0 L -10 0","M -10 2 L -10 10 L -2 10 M 2 10 L 10 10 L 10 2 M 10 -2 L 10 -10 L 2 -10 M -2 -10 L -10 -10 L -10 -2"),[]);return r.a.createElement("div",{className:"Maximise_Button"},r.a.createElement("svg",{viewBox:"0 0 30 30"},r.a.createElement("rect",Object.assign({x:"0",y:"0",width:"100%",height:"100%"},d())),r.a.createElement(z.Spring,{from:{t:0===o?1:0},to:{t:o},config:{tension:360,friction:24}},function(e){var t=e.t;return r.a.createElement("path",{ref:u,d:h(t),transform:"translate(15,15)"})})))},$=function(e){e.showHelp;var t=e.setShowHelp,a=Object(n.useState)(0),c=Object(l.a)(a,2),i=c[0],o=c[1],s=Object(n.useRef)(null),u=Object(J.a)({onHover:function(e){var a=e.hovering;o(a?1:0),t(a)}}),d=Object(n.useCallback)(m.j("M -5 -10 c 17 -2 17 4 5 10 c 0 0 0 0 0 7 M -1 11 h 2","M -2 4 c -20 -21 24 -21 4 0 c 0 8 -4 8 -4 0 M -2 4 h 4"),[]);return r.a.createElement("div",{className:"Help_Button"},r.a.createElement("svg",{viewBox:"0 0 30 30"},r.a.createElement("rect",Object.assign({x:"0",y:"0",width:"100%",height:"100%"},u())),r.a.createElement(z.Spring,{from:{t:0===i?1:0},to:{t:i},config:{tension:360,friction:24}},function(e){var t=e.t;return r.a.createElement("path",{ref:s,d:d(t),transform:"translate(15,15)"})})))},Q=a(21),ee=(a(80),function(e){var t=e.loading,a=Object(Q.b)({from:{opacity:t?0:1},opacity:t?1:0,delay:1e3}),c=Object(n.useRef)(null);return Object(n.useEffect)(function(){if(c.current){var e=m.o(c.current);!function t(){0!==a.opacity.value&&e.selectAll("#load_car_wheel").attr("transform","rotate(0)").transition().duration(500).ease(m.f).attr("transform","rotate(180)").on("end",t)}(),function t(){0!==a.opacity.value&&e.selectAll("#load_car").attr("transform","translate( 160, 195 )").transition().attr("transform","translate( 160, 193 )").on("end",t)}(),function t(){0!==a.opacity.value&&(e.selectAll("#load_car").transition("smokeLoop").duration(200).on("end",t),e.selectAll("#load_car").append("circle").attr("id","load_car_smoke").attr("cx",10).attr("cy",0).attr("r",5).attr("opacity",1).transition().duration(1e3).attr("cx",-50*Math.random()-50).attr("cy",-30*Math.random()-30).attr("r",50).attr("opacity",0).remove())}(),e.selectAll("#load_bush > g").each(function e(){var t=this;0!==a.opacity.value&&m.o(this).attr("transform","translate(700, 210)").transition().ease(m.f).duration(4e3*Math.random()+2e3).attr("transform","translate(-100, 210)").on("end",function(){return e.bind(t)()})})}}),r.a.createElement(Q.a.div,{className:"loadScreen",style:a},r.a.createElement("svg",{viewBox:"0 0 600 214",ref:c},r.a.createElement("g",{id:"load_road"},r.a.createElement("rect",{x:"0",y:"210",width:"100%",height:"2%"}),r.a.createElement("g",{id:"load_bush"},r.a.createElement("g",{id:"load_bush--1",transform:"translate(50,210)"},r.a.createElement("path",{d:"M 0 0 a 30 30 0 0 1 0 -50 a 30 30 0 0 1 45 -10 v 60 Z",fill:"#4CA134"}),r.a.createElement("path",{d:"M 44 -60 a 30 30 0 0 1 30 15 a 30 30 0 0 1 10 45 h -40 Z",fill:"#77BC1F"})),r.a.createElement("g",{id:"load_bush--2",transform:"translate(400,210)"},r.a.createElement("path",{d:"M 0 0 a 40 40 0 0 1 20 -50 a 40 40 0 0 1 40 -30 v 80 Z",fill:"#7C8F29"}),r.a.createElement("path",{d:"M 59 -80 a 40 40 0 0 1 30 50 a 40 40 0 0 1 10 30 h -39 Z",fill:"#9BB53F"}))),r.a.createElement("g",{id:"load_cloud"},r.a.createElement("line",{id:"load_cloud--1",x1:"200",x2:"400",y1:"30",y2:"30"}),r.a.createElement("line",{id:"load_cloud--2",x1:"240",x2:"500",y1:"40",y2:"40"}))),r.a.createElement("g",{id:"load_car_wheels",transform:"translate(223,193)"},r.a.createElement("g",{id:"load_car_wheel"},r.a.createElement("circle",{r:"18",id:"load_car_wheel_outer"}),r.a.createElement("circle",{r:"10",id:"load_car_wheel_inner"}),r.a.createElement("path",{d:"M -10 0 h 20 M 0 -10 v 20"}),r.a.createElement("path",{d:"M -8 0 h 16 M 0 -8 v 16",transform:"rotate(45)"})),r.a.createElement("use",{href:"#load_car_wheel",transform:"translate(144,0)"})),r.a.createElement("g",{id:"load_car"},r.a.createElement("path",{d:"M10 -10\n                            q 5 -10 0 -27\n                            l 42 -3\n                            q 7 -1 5 -5 l -3 -17\n                            q 55 -10 105 -5\n                            q 3 0 17 25\n                            l 63 5\n                            q 5 5 0 20\n                            q 8 5 2 16\n                            h -13\n                            a 22 22 0 1 0 -42 10\n                            h -105\n                            a 20 20 0 1 0 -38 -6\n                            q -15 0 -20 -4\n                            Z"}),r.a.createElement("g",{id:"load_car_windows"},r.a.createElement("path",{d:"M 67 -52 q -3 -4 4 -6 q 20 -3 30 -4 q 6 0 5 8 v 8 q 0 6 -5 6 h -20 q -5 0 -12 -10 Z"}),r.a.createElement("path",{d:"M 120 -62.5 l 28 0 v 22 h -33 q -2 0 -4 -5 v -13 q 0 -4 5 -4 Z"}),r.a.createElement("path",{d:"M 148 -62.5 q 4 0 6 4 l 8 11 q 5 6 -1 7 h -13"})),r.a.createElement("path",{d:"M 13 -19 q 20 -3 100 -5 q 100 -1 118 -2 l 8 -10",fill:"none",stroke:"silver"}))),r.a.createElement("h1",null,"Loading data..."))}),te=function(e,t){var a=function(t){return Object(o.a)({},e,t)},n=t instanceof Object?t:{type:t},r=n.type,c=n.payload;switch(r){case"setMulti":return a(c);case"addFilter":return a({filters:Object(o.a)({},e.filters,Object(v.a)({},c[0],c[1]))});case"setFilter":return a({filters:c});case"setView":return a({view:c});case"removeFilter":return delete e.filters[c],a({filters:Object(o.a)({},e.filters)});case"clearFilters":return a({filters:{}});case"setHoveredCP":return a({hoveredCP:c});case"clearHoveredCP":return a({hoveredCP:null});default:throw new Error("Display state: Action not recognised")}};a(81);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(function(){var e=Object(n.useState)(null),t=Object(l.a)(e,2),a=t[0],c=t[1],i=Object(n.useState)(!1),o=Object(l.a)(i,2),s=o[0],u=o[1],d=Object(n.useReducer)(te,{filters:{}}),h=Object(l.a)(d,2),p=h[0],v=h[1];Object(n.useEffect)(function(){u(!0),m.d("./devon.csv").then(function(e){var t=_(e);v({type:"setMulti",payload:{filters:{road_name:"A30",direction:"E"},view:["","HGVs"],hoveredCP:null}}),c(t),u(!1)})},[]),f(p.hoveredCP);var g=Object(n.useMemo)(function(){return a&&E(a,p.filters)},[a,p.filters]),y=Object(n.useCallback)(r.a.createElement(L,{data:a,filteredData:g,display:p,setDisplay:v}),[g,a]),b=Object(n.useCallback)(r.a.createElement(ee,{loading:s}),[s]);return r.a.createElement("div",{className:"App"},r.a.createElement("header",{className:"App_header"},r.a.createElement("h1",null,"Devon Annual Average Daily Flows (AADFs)")),r.a.createElement("div",{className:"page"},b,y,r.a.createElement(U,null,r.a.createElement(K,{helpText:"This is an overview of all the Count Points visible on the map. You can click any of the stacked elements or the legend keys to drill down into the data. Right click or just click an empty space to traverse back up again."},r.a.createElement(Y,{data:g,display:p,setDisplay:v},r.a.createElement(C,{data:a,display:p,setDisplay:v}))),r.a.createElement(K,{helpText:"This shows the evolution of vehicle counts over time, summed over all currently visible Count Points. Like the Overview, you can click elements to navigate in and out of the data. You can use the cursor to see the values for a specific year."},r.a.createElement(W,{data:g,display:p,setDisplay:v},r.a.createElement(C,{showDate:!1,data:a,display:p,setDisplay:v}))))))},null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[29,1,2]]]);
//# sourceMappingURL=main.9e9628fa.chunk.js.map