{"version":3,"sources":["logic/Hooks.js","logic/DataLogic.js","components/js/DataControls.js","components/js/Mapbox.js","logic/Reducers.js","components/js/HierarchicalGraph.js","components/js/AppFrame.js","components/js/LoadScreen.js","App.js","serviceWorker.js","index.js"],"names":["addMarker","CP","mapbox","bounds","setDisplay","pos","mapboxgl","LngLat","lng","lat","popup","Popup","setHTML","concat","road_name","displayName","marker","Marker","setLngLat","setPopup","addTo","data","markers","push","d3","getElement","select","append","attr","on","type","payload","id","this","parentNode","transition","duration","ev","extend","parseData","fetchResult","forEach","datum","countPoint","count_point_id","CountPoint","road_type","latitude","longitude","region_id","authority_id","local_authority_id","link_length","link_length_km","start_junction","start_junction_road_name","end_junction","end_junction_road_name","vehicleCounts","sum_vehicles","all_motor_vehicles","pedal_cycles","sum_goods","all_hgvs","lgvs","sum_hgvs","sum_bus_coach","buses_and_coaches","sum_cars_taxis","cars_and_taxis","sum_lgvs","sum_hgv_2_rigid","hgvs_2_rigid_axle","sum_hgv_3_artic","hgvs_3_or_4_articulated_axle","sum_hgv_3_rigid","hgvs_3_rigid_axle","sum_hgv_4_rigid","hgvs_4_or_more_rigid_axle","sum_hgv_5_artic","hgvs_5_articulated_axle","sum_hgv_6_artic","hgvs_6_articulated_axle","sum_push","sum_motorbike","two_wheeled_motor_vehicles","count","counts","year","Count","estimation_method","direction_of_travel","addDirection","Object","values","filterData","CPs","filters","console","log","filter","keys","length","entries","hasOwnProperty","every","_ref","_ref2","slicedToArray","value","distance","latLngDistance","center","radius","filterCounts","reduce","acc","addCounts","direction","vehicles","getCounts","VehicleCounts","hierarchy","sortAlphaNum","a","b","toString","reA","reN","aA","replace","bA","aN","parseInt","bN","d2r","d","Math","PI","phi_a","phi_b","del_phi","del_lambda","A","pow","sin","cos","atan2","sqrt","_ref3","parent","method","classCallCheck","isEstimated","VehicleCount","name","children","arguments","undefined","subcounts","val","objectSpread","child","flatten","possibleConstructorReturn","getPrototypeOf","call","_ref4","_ref5","key","descendant","defineProperty","total","addValue","_ref6","_ref7","each","node","FilterHolder","react_default","createElement","className","viewBox","style","transform","CPFilters","map","display","getCPOptions","Array","from","Set","sort","DataControls_FilterHolder","DataControls_FilterDropdown","title","options","DataControls_GeocoderFilter","x1","x2","y1","y2","strokeWidth","strokeDasharray","href","opacity","x","y","width","height","CountFilters","v","i","FilterDropdown","icon","active","setVal","onClick","onChange","target","option","GeocoderFilter","searchBox","useRef","radiusRef","geoCoder","accessToken","_useState3","useState","_useState4","setGeoCoder","useEffect","gc","MapboxGeocoder","clearAndBlurOnEsc","current","appendChild","onAdd","result","useGeocoder","clear","ref","text","Mapbox","filteredData","_useState","_useState2","mapMarkers","setMapMarkers","Map","mapRef","setMapbox","container","addControl","NavigationControl","useMapbox","LngLatBounds","includes","remove","_ne","fitBounds","padding","left","top","bottom","right","useMap","DataControls_CPFilters","displayReducer","state","action","updateState","newState","view","hoveredCP","Error","HierarchicalGraph","frame","overloadWarn","setOverloadWarn","useMemo","graph","selectAll","drawStacks","graphNode","descendants","find","barLabels","graphData","lastIndex","indexOf","route","preserveAspectRatio","fill","goUp","preventDefault","t","t_fadeIn","selection","t_fadeOut","_calculateStacks","calculateStacks","stackedData","subgroups","colour","max","apply","toConsumableArray","domain","range","parentBounds","join","enter","update","exit","activeEl","tmpmax","series","tmp_y","bandwidth","drawLegend","seriesLabels","group","label","reverse","drawAxes","t_slideIn","triggerEvent","event","onMove","onOut","onContext","grp","tickSize","tickPadding","tickSizeOuter","stack","AppSidebar","AppFrame","vspan","hspan","maximised","_setMaximised","_useSpring","useSpring","position","config","stiff","_useSpring2","setStyle","childrenRef","react_spring_web","div","AppFrame_MaximiseButton","setMaximised","_childrenRef$current$","getBoundingClientRect","to","onRest","MaximiseButton","blend","setBlend","path","bind","useGesture","onHover","hovering","onDragStart","pathInterp","useCallback","assign","renderprops","tension","friction","LoadScreen","loading","props","delay","carRef","car","wheelRotation","ease","carBob","smoke","random","bushSlide","_this","r","stroke","StreamGraph","Boolean","window","location","hostname","match","ReactDOM","render","setData","setLoading","_useReducer","useReducer","_useReducer2","then","newData","focusedCP","countsFilter","DataControls_CountFilters","memoMap","js_Mapbox","loadScreen","LoadScreen_LoadScreen","AppFrame_AppSidebar","AppFrame_AppFrame","HierarchicalGraph_HierarchicalGraph","App_StreamGraph","document","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.4b5241e1.chunk.js","sourcesContent":["import { useEffect, useState } from 'react';\r\nimport mapboxgl from 'mapbox-gl';\r\nimport MapboxGeocoder from '@mapbox/mapbox-gl-geocoder';\r\nimport * as d3 from 'd3';\r\n\r\nconst useMapbox = ({ accessToken, mapRef }) => {\r\n\r\n    const [ mapbox, setMapbox ] = useState( null );\r\n\r\n    useEffect( () => {\r\n\r\n        if( !mapRef.current ) return;\r\n\r\n        mapboxgl.accessToken = accessToken;\r\n\r\n        const map = new mapboxgl.Map({\r\n            container: mapRef.current,\r\n            style: 'mapbox://styles/jridley246/cjxi67z0i42vy1cldfj812u8x',\r\n        })\r\n\r\n        setMapbox( map )\r\n\r\n        map.addControl( new mapboxgl.NavigationControl(), 'bottom-left' );\r\n        map.markers = [];\r\n\r\n    }, [ accessToken, mapRef ])\r\n\r\n    return mapbox\r\n\r\n}\r\n\r\nconst useMap = ( mapbox, mapMarkers, display, setDisplay ) => {\r\n\r\n    useEffect( () => {\r\n\r\n        if( !mapbox || !mapMarkers ) return\r\n\r\n        const bounds = new mapboxgl.LngLatBounds();\r\n\r\n        //Remove old markers\r\n        mapbox.markers.filter( marker => !mapMarkers.includes( marker.data ) ).forEach( marker => { marker.data.marker = null; marker.remove() } );\r\n        mapbox.markers = mapbox.markers.filter( marker => mapMarkers.includes( marker.data ) );\r\n\r\n        //Add new markers\r\n        mapMarkers.forEach( CP => !CP.marker && addMarker( CP, mapbox, bounds, setDisplay ) );\r\n        //Fit map to markers\r\n        bounds._ne && mapbox.fitBounds( bounds, {\r\n            padding: { left: 50, top: 50, bottom: 50, right: 400 },\r\n            duration: 1000\r\n        });\r\n\r\n    }, [ mapbox, mapMarkers, setDisplay ] )\r\n\r\n}\r\n\r\nconst useGeocoder = ( map, searchBox, accessToken, setDisplay, radiusRef ) => {\r\n\r\n    const [ geoCoder, setGeoCoder ] = useState( null );\r\n\r\n    useEffect( () => {\r\n\r\n        if( !searchBox || !map ) return;\r\n\r\n        const gc = new MapboxGeocoder({\r\n            accessToken: accessToken,\r\n            mapboxgl: mapboxgl,\r\n            clearAndBlurOnEsc: false\r\n        });\r\n\r\n        searchBox.current.appendChild( gc.onAdd( map ) );\r\n        setGeoCoder( gc );\r\n\r\n        gc.on( \"result\", ev => setDisplay( { type: 'addFilter', payload: [ \"distance\", { ...ev.result, radius: radiusRef.current.value } ] } ));\r\n        gc.on( \"clear\", ev => setDisplay( { type: 'removeFilter', payload: \"distance\" } ) );\r\n\r\n\r\n    }, [map, searchBox, radiusRef, accessToken])\r\n\r\n    return geoCoder\r\n\r\n}\r\n\r\nexport { useMap, useMapbox, useGeocoder };\r\n\r\nconst addMarker = ( CP, mapbox, bounds, setDisplay ) => {\r\n\r\n    const highlightCP = function(){\r\n\r\n        setDisplay( { type: 'setHoveredCP', payload: CP.id } );\r\n\r\n        d3.select( this.parentNode )\r\n            .transition()\r\n            .duration( 200 )\r\n            .attr( \"transform\", \"translate( 0, -8.75 )scale( 1.5 )\" )\r\n\r\n    };\r\n    const unhighlightCP = function(){\r\n\r\n        setDisplay( 'clearHoveredCP' );\r\n\r\n        d3.select( this.parentNode )\r\n            .transition()\r\n            .attr( \"transform\", \"translate( 0, 0 )scale( 1 )\" )\r\n\r\n    };\r\n\r\n    const pos = new mapboxgl.LngLat( CP.lng, CP.lat );\r\n\r\n    const popup = new mapboxgl.Popup()\r\n        .setHTML(`\r\n                <div class=\"MapPopup\">\r\n                    <h1>${CP.road_name}</h1>\r\n                    <h2>${CP.displayName}</h2>\r\n                    <button id=\"onBtn\" class=\"btn btn-sm\">\r\n                        BeepBoop\r\n                    </button>\r\n                </div>\r\n            `)\r\n\r\n    const marker = new mapboxgl.Marker()\r\n        .setLngLat( pos )\r\n        .setPopup( popup )\r\n        .addTo( mapbox )\r\n\r\n    marker.data = CP;\r\n    CP.marker = marker;\r\n    mapbox.markers.push( marker );\r\n\r\n    //Add rect for input capture...default marker svg is messy for event handling\r\n    d3.select( marker.getElement() ).select( \"svg\" )\r\n        .append( \"rect\" )\r\n        .attr( \"x\", 0 )\r\n        .attr( \"y\", 0 )\r\n        .attr( \"width\", \"100%\", )\r\n        .attr( \"height\", \"100%\" )\r\n        .attr( \"fill\", \"#0000\" )\r\n        .on( \"mouseenter\", highlightCP )\r\n        .on( \"mouseout\", unhighlightCP )\r\n\r\n    popup.on( \"open\", ev => {});//SET FOCUSEDCP   setDisplay( { type: 'setFilter', payload: {id: CP.id} } ) );\r\n\r\n    bounds.extend( pos );\r\n\r\n}\r\n","import * as d3 from 'd3';\r\n\r\nexport const parseData = fetchResult => {\r\n\r\n    let data = {};\r\n\r\n    fetchResult.forEach( datum => {\r\n\r\n        const countPoint = data[datum.count_point_id] || new CountPoint({\r\n            road_name: datum.road_name,\r\n            id: datum.count_point_id,\r\n            road_type: datum.road_type,\r\n            lat: +datum.latitude,\r\n            lng: +datum.longitude,\r\n            region_id: datum.region_id,\r\n            authority_id: datum.local_authority_id,\r\n            link_length: datum.link_length_km,\r\n            start_junction: datum.start_junction_road_name,\r\n            end_junction: datum.end_junction_road_name\r\n        });\r\n\r\n        data[datum.count_point_id] = countPoint;\r\n\r\n        const vehicleCounts = {\r\n            sum_vehicles: +datum.all_motor_vehicles + +datum.pedal_cycles,\r\n            sum_goods: +datum.all_hgvs + +datum.lgvs,\r\n            sum_hgvs: datum.all_hgvs,\r\n            sum_bus_coach: datum.buses_and_coaches,\r\n            sum_cars_taxis: datum.cars_and_taxis,\r\n            sum_lgvs: datum.lgvs,\r\n            sum_hgv_2_rigid: datum.hgvs_2_rigid_axle,\r\n            sum_hgv_3_artic: datum.hgvs_3_or_4_articulated_axle,\r\n            sum_hgv_3_rigid: datum.hgvs_3_rigid_axle,\r\n            sum_hgv_4_rigid: datum.hgvs_4_or_more_rigid_axle,\r\n            sum_hgv_5_artic: datum.hgvs_5_articulated_axle,\r\n            sum_hgv_6_artic: datum.hgvs_6_articulated_axle,\r\n            sum_push: datum.pedal_cycles,\r\n            sum_motorbike: datum.two_wheeled_motor_vehicles,\r\n        };\r\n\r\n        const count = data[datum.count_point_id].counts[datum.year] || new Count(\r\n            data[datum.count_point_id],\r\n            datum.year,\r\n            datum.estimation_method,\r\n            datum.direction_of_travel,\r\n        )\r\n\r\n        data[datum.count_point_id].counts[datum.year] = count;\r\n\r\n        count.addDirection( datum.direction_of_travel, vehicleCounts );\r\n\r\n    })\r\n\r\n    data = Object.values( data );\r\n    return data\r\n\r\n}\r\n\r\nexport const filterData = ( CPs, filters ) => {\r\n    console.log( filters );\r\n    return CPs.filter( CP => {\r\n        return (\r\n            ( Object.keys( filters ).length > 0 ? Object.entries( filters ).filter( filter => CP.hasOwnProperty( filter[0] ) ).every( ([ filter, value ]) => CP[filter] === value ) : true ) &&\r\n            ( filters.distance ? latLngDistance( filters.distance.center, [CP.lng,CP.lat] ) < filters.distance.radius*1000 : true )\r\n        )\r\n    })\r\n}\r\n\r\nexport const filterCounts = ( CP, filters ) => {\r\n\r\n    let counts = Object.values( CP.counts );\r\n    if( filters.year ) counts = counts.filter( count => count.year === filters.year );\r\n    return counts.reduce( ( acc, year ) => acc.addCounts( filters.direction || \"Total\", year.vehicles.getCounts( filters.direction ) ), new VehicleCounts( CP ) ).hierarchy\r\n\r\n}\r\n\r\nexport const sortAlphaNum = ( a, b ) => {\r\n\r\n    a = a.toString();\r\n    b = b.toString();\r\n\r\n    const reA = /[^a-zA-Z]/g;\r\n    const reN = /[^0-9]/g;\r\n    const aA = a.replace( reA, \"\" );\r\n    const bA = b.replace( reA, \"\" );\r\n\r\n    if (aA === bA) {\r\n\r\n        const aN = parseInt( a.replace( reN, \"\" ), 10 );\r\n        const bN = parseInt( b.replace( reN, \"\" ), 10 );\r\n\r\n        return aN === bN ? 0 : aN > bN ? 1 : -1;\r\n\r\n    } else {\r\n\r\n        return aA > bA ? 1 : -1;\r\n\r\n    }\r\n\r\n}\r\n\r\nexport const latLngDistance = ( a, b ) => {\r\n\r\n    const d2r = d => d*Math.PI/180;\r\n    const R = 6371e3; //Earth's radius\r\n    const phi_a = d2r( a[1] );\r\n    const phi_b = d2r( b[1]*Math.PI/180 );\r\n    const del_phi = d2r( b[1] - a[1] );\r\n    const del_lambda = d2r( b[0] - a[0] );\r\n\r\n    const A = Math.pow( Math.sin( del_phi / 2 ), 2 ) + Math.cos( phi_a )*Math.cos( phi_b )*Math.pow( Math.sin( del_lambda / 2 ), 2 );\r\n    const C = 2 * Math.atan2( Math.sqrt(A), Math.sqrt( 1 - A ) );\r\n\r\n    return R * C\r\n\r\n}\r\n\r\nfunction CountPoint({ road_name, id, road_type, lat, lng, region_id, authority_id, link_length, start_junction, end_junction }) {\r\n\r\n    this.road_name = road_name;\r\n    this.id = id.toString();\r\n    this.road_type = road_type;\r\n    this.lat = lat;\r\n    this.lng = lng;\r\n    this.region_id = region_id.toString();\r\n    this.authority_id = authority_id.toString();\r\n    this.link_length = link_length;\r\n    this.start_junction = start_junction;\r\n    this.end_junction = end_junction;\r\n    this.displayName = start_junction ? end_junction + \"_\" + start_junction : this.id;\r\n    this.counts = {};\r\n\r\n}\r\n\r\nclass Count{\r\n    constructor( parent, year, method ){\r\n\r\n        this.parent = parent;\r\n        this.year = year.toString();\r\n        this.isEstimated = method === \"Estimated\";\r\n        this.vehicles = new VehicleCounts( this );\r\n\r\n    }\r\n\r\n    addDirection( direction, counts ){\r\n        this.vehicles.addCounts( direction, counts );\r\n        return this\r\n    }\r\n\r\n}\r\n\r\nclass VehicleCount{\r\n    constructor( name, parent, children = {} ){\r\n        this.name = name;\r\n        this.values = {};\r\n        this.subcounts = children;\r\n        this.parent = parent;\r\n    }\r\n\r\n    addValue( name, val ){\r\n        this.values[name] = this.values[name] ? this.values[name] + val : val;\r\n        return this\r\n    }\r\n\r\n    get children(){\r\n        return Object.values( this.subcounts )\r\n    }\r\n\r\n    get total(){\r\n        return Object.values( this.values ).reduce( ( acc, val ) => acc + val, 0 )\r\n    }\r\n\r\n    flatten(){\r\n        return { ...this.subcounts, ...this.children.reduce( ( acc, child ) => ({ ...acc, ...child.flatten() }), {} ) }\r\n    }\r\n}\r\n\r\nclass VehicleCounts extends VehicleCount{\r\n    constructor( parent ){\r\n\r\n        super( \"Total Vehicles\", parent, {\r\n            sum_goods: new VehicleCount( \"Goods\", parent, {\r\n                sum_hgvs: new VehicleCount( \"HGVs\", parent, {\r\n                    sum_hgv_6_artic: new VehicleCount( \"Six-axle Artic\", parent ),\r\n                    sum_hgv_5_artic: new VehicleCount( \"Five-axle Artic\", parent ),\r\n                    sum_hgv_4_rigid: new VehicleCount( \"Four-axle Rigid\", parent ),\r\n                    sum_hgv_3_rigid: new VehicleCount( \"Three-axle Rigid\", parent ),\r\n                    sum_hgv_3_artic: new VehicleCount( \"Three-axle Artic\", parent ),\r\n                    sum_hgv_2_rigid: new VehicleCount( \"Two-axle Rigid\", parent ),\r\n                }),\r\n                sum_lgvs: new VehicleCount( \"LGVs\", parent )\r\n            }),\r\n            sum_push: new VehicleCount( \"Pedal Cycles\", parent ),\r\n            sum_motorbike: new VehicleCount( \"Motorbikes\", parent ),\r\n            sum_bus_coach: new VehicleCount( \"Buses and Coaches\", parent ),\r\n            sum_cars_taxis: new VehicleCount( \"Cars and Taxis\", parent ),\r\n        })\r\n\r\n    }\r\n\r\n    getCounts( filter ){\r\n        return Object.entries( this.flatten() ).reduce( ( acc, [ key, descendant ] ) => ({ ...acc, [key]: filter ? ( descendant.values[filter] || 0 ) : descendant.total }), { sum_vehicles: filter ? ( this.values[filter] || 0 ) : this.total } )\r\n    }\r\n\r\n    addCounts( name, vehicleCounts ){\r\n        this.addValue( name, vehicleCounts.sum_vehicles );\r\n        Object.entries( this.flatten() ).forEach( ([ key, descendant ]) => vehicleCounts[key] && descendant.addValue( name, +vehicleCounts[key] ) );\r\n\r\n        return this\r\n    }\r\n\r\n    get hierarchy(){\r\n        return d3.hierarchy( this )\r\n            .each( node => node.value = node.data.total )\r\n    }\r\n}\r\n","import React, { useState, useEffect, useRef } from 'react';\r\nimport { sortAlphaNum } from '../../logic/DataLogic.js';\r\nimport { useGeocoder } from '../../logic/Hooks.js';\r\nimport '../css/DataControls.scss';\r\n\r\nconst FilterHolder = ({children, id}) => {\r\n\r\n    return (\r\n        <div className=\"component-filterHolder\" id={id}>\r\n            <div>\r\n                <svg viewBox=\"0 0 100 100\">\r\n                    <g style={{transform: \"translate(50%,50%)\"}}>\r\n                        <path d=\"M -7 -10 l -30 -30 h 74 l -30 30 l -5 45 l -6 5 Z\"/>\r\n                    </g>\r\n                </svg>\r\n                <h1>Filters</h1>\r\n            </div>\r\n            {children}\r\n        </div>\r\n    )\r\n}\r\n\r\nexport const CPFilters = ({data, map, display, setDisplay}) => {\r\n\r\n    const getCPOptions = key => data ? Array.from( new Set( data.map( CP => CP[key] ) ) ).sort( sortAlphaNum ) : [\"NO DATA\"];\r\n\r\n    return(\r\n        <FilterHolder id=\"countPointFilters\">\r\n            <FilterDropdown title=\"Count Point\" id=\"id\" options={getCPOptions( \"id\" )} display={display} setDisplay={setDisplay}>\r\n                <path id=\"icon_marker\" d=\"M -25 0 a 30 30 0 1 1 50 0 l -25 40 l -25 -40 M -12.5 -15 a 12.5 12.5 0 0 0 25 0 a 12.5 12.5 0 0 0 -25 0\"/>\r\n            </FilterDropdown>\r\n            <GeocoderFilter display={display} map={map} setDisplay={setDisplay}>\r\n                <path id=\"icon_marker\" d=\"M -25 0 a 30 30 0 1 1 50 0 l -25 40 l -25 -40 M -12.5 -15 a 12.5 12.5 0 0 0 25 0 a 12.5 12.5 0 0 0 -25 0\" transform=\"translate(-15)\"/>\r\n                <line x1=\"-15\" x2=\"25\" y1=\"40\" y2=\"10\" strokeWidth=\"5\" strokeDasharray=\"6\"/>\r\n                <use href=\"#icon_marker\" transform=\"translate(25,-10)scale(0.6)\" opacity=\"0.6\"/>\r\n            </GeocoderFilter>\r\n            <FilterDropdown title=\"Road Name\" id=\"road_name\" options={getCPOptions( \"road_name\" )} display={display} setDisplay={setDisplay}>\r\n                <line x1=\"-20\" x2=\"-20\" y1=\"35\" y2=\"15\" strokeWidth=\"5\"/>\r\n                <line x1=\"20\" x2=\"20\" y1=\"35\" y2=\"15\" strokeWidth=\"5\"/>\r\n                <rect x=\"-40\" y=\"-35\" width=\"80\" height=\"50\"/>\r\n                <text x=\"0\" y=\"2\">A66</text>\r\n            </FilterDropdown>\r\n            <FilterDropdown title=\"Road Type\" id=\"road_type\" options={getCPOptions( \"road_type\" )} display={display} setDisplay={setDisplay}>\r\n                <path d=\"M -10 -40 h 7 l -1 20 h -8 Z\"/>\r\n                <path d=\"M 10 -40 h -7 l 1 20 h 8 Z\"/>\r\n                <path d=\"M -13 0 h 9 l -2 40 h -11 Z\"/>\r\n                <path d=\"M 13 0 h -9 l 2 40 h 11 Z\"/>\r\n                <path d=\"M -40 -15 h 80 v 10 h -7 q -3 0 -3 3 v 7 h -7 l -3 -7 q 0 -3 -3 -3 h -34 q -3 0 -3 3 l -3 7 h -7 v -7 q 0 -3 -3 -3 h -7 v -10\"/>\r\n            </FilterDropdown>\r\n        </FilterHolder>\r\n    )\r\n\r\n}\r\n\r\nexport const CountFilters = ({data, display, setDisplay}) => {\r\n\r\n    return (\r\n        <FilterHolder id=\"countFilters\">\r\n            <FilterDropdown title=\"Year\" id=\"year\" options={Array.from( {length:19}, ( v, i ) => (2000 + i).toString() )} display={display} setDisplay={setDisplay}>\r\n                <path d={`M -30 -30 q -10 0 -10 10 v 50 q 0 10 10 10 h 60 q 10 0 10 -10 v -50 q 0 -10 -10 -10 h -5 a 10 10 0 0 0 -20 0 h -10 a 10 10 0 0 0 -20 0 h -5\r\n                          M -29 -14 h  13 v  12 h -13 v -12\r\n                          M -14 -14 h  13 v  12 h -13 v -12\r\n                          M  1  -14 h  13 v  12 h -13 v -12\r\n                          M  16 -14 h  13 v  12 h -13 v -12\r\n                          M -29  2  h  13 v  12 h -13 v -12\r\n                          M -14  2  h  13 v  12 h -13 v -12\r\n                          M  1   2  h  13 v  12 h -13 v -12\r\n                          M  16  2  h  13 v  12 h -13 v -12\r\n                          M -29  18 h  13 v  12 h -13 v -12\r\n                          M -14  18 h  13 v  12 h -13 v -12`\r\n                      }/>\r\n            </FilterDropdown>\r\n            <FilterDropdown title=\"Direction\" id=\"direction\" options={[\"N\",\"S\",\"E\",\"W\"]} display={display} setDisplay={setDisplay}>\r\n                <path d={`M -45 0 a 45 45 0 0 0 90 0 a 45 45 0 0 0 -90 0 M 35 0 a 35 35 0 0 1 -70 0 a 35 35 0 0 1 70 0`}/>\r\n                <path d={`M 0 34 l -10 -32 a 20 20 0 0 0 20 0 l -10 32`} transform=\"rotate(20)\"/>\r\n                <path d={`M 0 34 l -10 -32 a 20 20 0 0 0 20 0 l -10 32`} transform=\"rotate(200)\"/>\r\n            </FilterDropdown>\r\n        </FilterHolder>\r\n    )\r\n\r\n}\r\n\r\nconst FilterDropdown = ({ children: icon, title, id, options, display, setDisplay }) => {\r\n\r\n    let active = display.filters.hasOwnProperty( id );\r\n    const setVal = val => {\r\n        if( active ){\r\n            setDisplay( { type: `addFilter`, payload: [ id, val ] } );\r\n        }else {\r\n            setDisplay( { type: `removeFilter`, payload: id } );\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div className={`component-filterDropdown${ active ? \" active\" : \"\"}`}>\r\n            <div className=\"header\" onClick={() => { active = !active; setVal( options[0] ) }}>\r\n                <svg viewBox=\"0 0 100 100\">\r\n                    <g style={{transform: \"translate(50%,50%)\"}}>\r\n                        {icon}\r\n                    </g>\r\n                </svg>\r\n            </div>\r\n            <select onChange={ev => setVal( ev.target.value )} value={display.filters[id]||\"\"}>\r\n                {options.map( option => <option key={option} value={option}>{option}</option> )}\r\n            </select>\r\n            <div className=\"header_text\" onClick={() => { active = !active; setVal( options[0] ) }}>\r\n                <h1 className=\"title\">{title}</h1>\r\n                <h1 className=\"currentFilter\">{display.filters[id]}</h1>\r\n            </div>\r\n        </div>\r\n    )\r\n\r\n}\r\n\r\nconst GeocoderFilter = ({children: icon, map, display, setDisplay}) => {\r\n\r\n        let active = display.filters.hasOwnProperty( \"distance\" );\r\n        const searchBox = useRef( null );\r\n        const radiusRef = useRef( null );\r\n        const geoCoder = useGeocoder( map, searchBox, 'pk.eyJ1IjoianJpZGxleTI0NiIsImEiOiJjanhpMzYxdXcxbWliNDFsN2g2bGg3ODg2In0.qqSDB24vCq0mdKUCdY4zgw', setDisplay, radiusRef );\r\n\r\n        const setVal = val => {\r\n            if( active ){\r\n                setDisplay( { type: `addFilter`, payload: [ \"distance\", display.filters.distance ? { ...display.filters.distance, radius: val } : null ] } );\r\n            }else {\r\n                geoCoder.clear()\r\n            }\r\n        }\r\n\r\n        return (\r\n            <div className={`component-geoCoder${ active ? \" active\" : \"\"}`}>\r\n                <div className=\"header\" onClick={() => { active = !active; setVal( 5 ) }}>\r\n                    <svg viewBox=\"0 0 100 100\">\r\n                        <g style={{transform: \"translate(50%,50%)\"}}>\r\n                            {icon}\r\n                        </g>\r\n                    </svg>\r\n                </div>\r\n                <div className=\"geoCoder\" ref={searchBox}>\r\n                    <select ref={radiusRef} onChange={ev => setVal( ev.target.value )} value={display.filters.distance ? display.filters.distance.radius : \"5\"}>\r\n                        <option value=\"5\">&lt;5km</option>\r\n                        <option value=\"10\">&lt;10km</option>\r\n                        <option value=\"15\">&lt;15km</option>\r\n                    </select>\r\n                </div>\r\n                <div className=\"header_text\" onClick={() => { active = !active; setVal( 5 ) }}>\r\n                    <h1 className=\"title\">Distance</h1>\r\n                    <h1 className=\"currentFilter\">{display.filters.distance ? display.filters.distance.text : \"\"}</h1>\r\n                </div>\r\n            </div>\r\n        )\r\n\r\n}\r\n","import React, { useState, useRef, useEffect } from 'react';\r\nimport { useMapbox, useMap } from '../../logic/Hooks.js';\r\nimport { CPFilters } from './DataControls.js';\r\nimport '../css/Mapbox.scss';\r\n\r\nconst Mapbox = ({ children, data, filteredData, display, setDisplay }) => {\r\n\r\n    const [ mapMarkers, setMapMarkers ] = useState( null );\r\n    const map = useRef( null );\r\n\r\n    const Map = useMapbox({\r\n        accessToken: 'pk.eyJ1IjoianJpZGxleTI0NiIsImEiOiJjanhpMzYxdXcxbWliNDFsN2g2bGg3ODg2In0.qqSDB24vCq0mdKUCdY4zgw',\r\n        mapRef: map,\r\n    } );\r\n\r\n    useMap( Map, mapMarkers, display, setDisplay );\r\n\r\n    useEffect( () => {\r\n\r\n        if( !filteredData ) return;\r\n        setMapMarkers( filteredData )\r\n\r\n    }, [ filteredData, display.filters ])\r\n\r\n    return (\r\n        <div className=\"Mapbox\" ref={map}>\r\n            <CPFilters data={data} map={Map} display={display} setDisplay={setDisplay}/>\r\n        </div>\r\n    )\r\n\r\n}\r\n\r\nexport default Mapbox\r\n","export const displayReducer = ( state, action ) => {\r\n\r\n    const updateState = newState => ({ ...state, ...newState });\r\n\r\n    const { type, payload } = action instanceof Object ? action : { type: action };\r\n\r\n    switch( type ){\r\n        case 'setMulti':\r\n            return updateState( payload )\r\n        case 'addFilter':\r\n            return updateState( { filters: { ...state.filters, [payload[0]]: payload[1] } } )\r\n        case 'setFilter':\r\n            return updateState( { filters: payload } )\r\n        case 'setView':\r\n            return updateState( { view: payload } )\r\n        case 'removeFilter':\r\n            delete state.filters[payload];\r\n            return updateState( { filters: { ...state.filters } } )\r\n        case 'clearFilters':\r\n            return updateState( { filters: {} } )\r\n        case 'setHoveredCP':\r\n            return updateState( { hoveredCP: payload } )\r\n        case 'clearHoveredCP':\r\n            return updateState( { hoveredCP: null } )\r\n\r\n        default:\r\n            throw new Error( \"Display state: Action not recognised\" )\r\n    }\r\n\r\n}\r\n","import React, { useEffect, useState, useRef, useMemo } from 'react';\r\nimport { filterCounts } from '../../logic/DataLogic.js';\r\nimport * as d3 from 'd3';\r\nimport '../css/HierarchicalGraph.scss';\r\n\r\nexport default function HierarchicalGraph({ children, data, display, setDisplay }){\r\n\r\n    const frame = useRef( null );\r\n    const [ overloadWarn, setOverloadWarn ] = useState( false );\r\n    const bounds = useMemo( () => ({\r\n        top: 10,\r\n        left: 100,\r\n        height: 370,\r\n        width: 590\r\n    }), []);\r\n\r\n    useEffect( () => {\r\n\r\n        if( !data ) return;\r\n\r\n        const graph = d3.select( frame.current );\r\n\r\n        setOverloadWarn( data.length > 25 );\r\n        if( data.length > 25 ){\r\n\r\n            graph.selectAll( \".StackedBar_Bars > g\" ).remove();\r\n            return;\r\n        }\r\n\r\n        drawStacks( graph, bounds, display.view, setDisplay,\r\n            data.reduce( ( acc, CP ) => {\r\n\r\n                const graphNode = filterCounts( CP, display.filters ).descendants().find( descendant => descendant.data.name === display.view[1] );\r\n\r\n                acc.barLabels.push( CP.id );\r\n                acc.graphData.push( graphNode );\r\n                acc.lastIndex = acc.lastIndex === undefined ? ( graphNode.parent ? graphNode.parent.children.indexOf( graphNode ) : 0 ) : acc.lastIndex;\r\n                acc.route = acc.route === undefined || display.view[0]\r\n\r\n                return acc\r\n\r\n            }, { barLabels: [], graphData: [], lastIndex: undefined })\r\n        )\r\n\r\n\r\n    }, [data, display.filters, display.view, bounds, setDisplay])\r\n\r\n    useEffect( () => {\r\n\r\n        if( display.hoveredCP ){\r\n\r\n            d3.selectAll( `.StackedBar_Bars > g > rect:not([class=\"${display.hoveredCP}\"])` )\r\n                .transition( \"fade\" )\r\n                .duration( 100 )\r\n                .attr( \"opacity\", 0.2 )\r\n\r\n        } else{\r\n\r\n            d3.selectAll( `.StackedBar_Bars > g > rect` )\r\n                .transition( \"fade\" )\r\n                .duration( 50 )\r\n                .attr( \"opacity\", 1 )\r\n\r\n        }\r\n\r\n\r\n    }, [ display.hoveredCP ])\r\n\r\n    return (\r\n        <div className=\"HierarchicalGraph\">\r\n            <div className={`HierarchicalGraph_overloadWarning${ overloadWarn ? \" overload\" : \"\"}`}>\r\n                <p>\r\n                    Phew, that's a lot of data...{data ? data.length : 0} count points to be exact!\r\n                    <br/>\r\n                    Try applying more filters\r\n                </p>\r\n            </div>\r\n            {children}\r\n            <svg className=\"StackedBar\" viewBox=\"0 0 900 500\" preserveAspectRatio=\"xMidYMid\" ref={frame}>\r\n                <rect className=\"StackedBar_BG\" x=\"0\" y=\"0\" width=\"100%\" height=\"100%\" fill=\"#0000\"/>\r\n                <text className=\"StackedBar_Title\"></text>\r\n                <g className=\"StackedBar_Legend\" transform={`translate( ${bounds.left+bounds.width + 50}, 100 )`}/>\r\n                <g className=\"StackedBar_Axes\">\r\n                    <g className=\"StackedBar_Axes--Left\" transform={`translate( ${bounds.left}, 0 )`}/>\r\n                    <g className=\"StackedBar_Axes--Bottom\" transform={`translate( 0, ${bounds.height+bounds.top} )`}/>\r\n                </g>\r\n                <g className=\"StackedBar_Bars\"/>\r\n            </svg>\r\n        </div>\r\n    )\r\n}\r\n\r\nconst drawStacks = ( graph, bounds, [ route, title ] , setDisplay, { barLabels, graphData, lastIndex } ) => {\r\n\r\n    //Navigation functions\r\n    const drillDown = d => {\r\n\r\n            d[0].data.children && setDisplay( { type: 'setView', payload: [\"descent\", d.key] } );\r\n\r\n    }\r\n    const goUp = d => {\r\n\r\n        d3.event.preventDefault();\r\n        graphData[0].parent && setDisplay( { type: 'setView', payload: [\"ascent\", graphData[0].parent.data.name] } );\r\n\r\n    }\r\n\r\n    graph.select( \".StackedBar_BG\" ).on( \"contextmenu click\", goUp );\r\n\r\n    //Animations\r\n    const t = d3.transition().duration( 500 );\r\n    const t_fadeIn = selection => {\r\n        selection\r\n            .transition( \"fade\" )\r\n            .duration( 50 )\r\n            .attr( \"opacity\", 1 )\r\n    }\r\n    const t_fadeOut = selection => {\r\n        selection\r\n            .transition( \"fade\" )\r\n            .duration( 100 )\r\n            .attr( \"opacity\", 0.2 )\r\n    }\r\n\r\n    const { stackedData, subgroups, colour } = calculateStacks( graphData );\r\n    const max = Math.max( ...graphData.map( datum => datum.value ) );\r\n\r\n    //Scales\r\n    const x = d3.scaleBand()\r\n        .domain( barLabels )\r\n        .range( [ bounds.left, bounds.width+bounds.left ] )\r\n        .padding( [0.2] )\r\n\r\n    const y = d3.scaleLinear()\r\n        .domain( [ 0, max*1.1 ] )\r\n        .range( [ bounds.height+bounds.top, bounds.top ] )\r\n\r\n    //If descending, initial [y0, y1] of parent rects for transition\r\n    const parentBounds = [];\r\n\r\n    //--------------------\r\n    //Stacks\r\n\r\n    //Event handlers\r\n    const onMove = function( d ){\r\n\r\n        const activeEl = this;\r\n        d3.selectAll( \".StackedBar_Bars > g\" ).filter( function(){ return this !== activeEl } ).call( t_fadeOut );\r\n        d3.selectAll( `.StackedBar_Legend > g:not([id=\"${d.key}\"])` ).call( t_fadeOut );\r\n\r\n    }\r\n    const onOut = function(){\r\n\r\n        const activeEl = this;\r\n        d3.selectAll( \".StackedBar_Bars > g, .StackedBar_Legend > g\" ).filter( function(){ return this !== activeEl } ).call( t_fadeIn );\r\n\r\n    }\r\n\r\n    //Add new stack groups\r\n    graph.select( \".StackedBar_Bars\" ).selectAll( \"g\" ).data( stackedData, d => d.key )\r\n        .join(\r\n            enter => {\r\n\r\n                const newGs = enter.append( \"g\" )\r\n                    .attr( \"class\", d => d.key )\r\n                    .attr( \"fill\", d => colour( d.key ) )\r\n\r\n                return newGs\r\n\r\n            },\r\n            update => update,\r\n            exit => {\r\n\r\n                if( route === \"descent\" ){\r\n                    //If drilling down, parent group is replaced, so need to store dimensions before removal\r\n                    exit\r\n                        .filter( ( d, i ) => i === lastIndex )\r\n                        .selectAll( \"rect\" )\r\n                        .each( function(){ parentBounds.push( [ +d3.select( this ).attr( \"y\" ), +d3.select( this ).attr( \"height\" ) ] ) } )\r\n\r\n                }\r\n\r\n                exit.remove()\r\n\r\n            }\r\n        )\r\n        .on( \"mousemove\", onMove )\r\n        .on( \"mouseout\", onOut )\r\n        .on( \"click\", drillDown )\r\n        .on( \"contextmenu\", goUp )\r\n        //NEW RECTS\r\n        .selectAll( \"rect\" ).data( d => d )\r\n            .join(\r\n                enter => {\r\n\r\n                    enter = enter.append( \"rect\" );\r\n\r\n                    //Use stored parent rect dimensions for smooth transition in descendant rects\r\n                    if( route === \"descent\" ){\r\n\r\n                        enter\r\n                            .each( function( d, i ){\r\n\r\n                                const tmpmax = Math.max( ...stackedData.map( series => series[i][1] ) );\r\n\r\n                                const tmp_y = d3.scaleLinear()\r\n                                    .domain( [ 0, tmpmax ] )\r\n                                    .range( [ parentBounds[i][0] + parentBounds[i][1], parentBounds[i][0] ] )\r\n\r\n                                d3.select( this )\r\n                                    .attr( \"y\", tmp_y( d[1] ) )\r\n                                    .attr( \"height\", tmp_y( d[0] ) - tmp_y( d[1] ) )\r\n\r\n                            })\r\n\r\n                    } else {\r\n\r\n                        enter\r\n                            .attr( \"y\", d => y( d[1] ) )\r\n                            .attr( \"height\", 0 )\r\n\r\n                    }\r\n\r\n                    return enter\r\n\r\n                }\r\n            )\r\n            .attr( \"class\", ( d, i ) => d.data.data.parent.id )\r\n            .attr( \"x\", ( d, i ) => x( barLabels[i] ) )\r\n            .attr( \"width\", x.bandwidth() )\r\n            .transition( t )\r\n            .attr( \"y\", d => y( d[1] ) )\r\n            .attr( \"height\", d => y( d[0] ) - y( d[1] ) )\r\n\r\n\r\n    //Update legend\r\n    drawLegend( graph, {\r\n        title: title,\r\n        seriesLabels: subgroups.map( ( group, i ) => ({ label: group, colour: colour( group ) }) ).reverse()\r\n    })\r\n\r\n    //Update Axes\r\n    drawAxes( graph, x, y );\r\n\r\n}\r\n\r\nconst drawLegend = ( graph, { title, seriesLabels } ) => {\r\n    //Draws linked legend with input event handlers\r\n    //Animations\r\n    const t_slideIn = function( selection ){\r\n\r\n        selection\r\n            .attr( \"x\", 100 )\r\n            .attr( \"opacity\", 0 )\r\n            .transition( \"fade\" )\r\n            .duration( 200 )\r\n            .attr( \"x\", 0 )\r\n            .attr( \"opacity\", 1 )\r\n\r\n    }\r\n\r\n    //Event Handlers\r\n    const triggerEvent = ( d, event ) => {\r\n        d3.select( `[class=\"${d.label}\"]` )\r\n            .each( function( d, i ){\r\n                d3.select( this ).on( event ).apply( this, [ d, i ] )\r\n            })\r\n    }\r\n    const onMove = d => triggerEvent( d, \"mousemove\" );\r\n    const onOut = d => triggerEvent( d, \"mouseout\" );\r\n    const onClick = d => triggerEvent( d, \"click\" );\r\n    const onContext = d => triggerEvent( d, \"contextmenu\" );\r\n\r\n    //Enter, update, exit\r\n    graph.select( \".StackedBar_Legend\" ).selectAll( \"g\" ).data( seriesLabels, d => d.label ).join(\r\n        enter => {\r\n\r\n            const grp = enter.append( \"g\" )\r\n                .attr( \"class\", \"legend_entry\" )\r\n                .attr( \"id\", d => d.label )\r\n                .attr( \"transform\", ( d, i ) => `translate( 0, ${i*25} )` )\r\n                .on( \"mousemove\", onMove )\r\n                .on( \"mouseout\", onOut )\r\n                .on( \"click\", onClick )\r\n                .on( \"contextmenu\", onContext )\r\n\r\n            grp.append( \"circle\" )\r\n                .attr( \"cx\", \"-12\" )\r\n                .attr( \"cy\", -6 )\r\n                .attr( \"r\", 10 )\r\n                .attr( \"fill\", d => d.colour )\r\n                .call( t_slideIn )\r\n\r\n            grp.append( \"text\" )\r\n                .text( d => d.label )\r\n                .attr( \"fill\", d => d.colour )\r\n                .call( t_slideIn )\r\n\r\n        },\r\n        update => {},\r\n        exit => { exit.remove() }\r\n    )\r\n\r\n}\r\n\r\nconst drawAxes = ( graph, x, y ) => {\r\n    //Draws axes on graph, smooth transitions\r\n    const frame = graph.select( \".StackedBar_Axes\" )\r\n\r\n    frame.select( \".StackedBar_Axes--Left\" )\r\n        .transition()\r\n        .call( d3.axisLeft( y ).tickSize( -600 ) )\r\n\r\n    frame.select( \".StackedBar_Axes--Bottom\" )\r\n        .transition()\r\n        .call( d3.axisBottom( x ).tickPadding([0]).tickSizeOuter([0]) )\r\n        .selectAll( \"text\" )\r\n        .attr( \"y\", 0 )\r\n        .attr( \"dx\", -9 )\r\n\r\n    frame.select( \".StackedBar_Axes--Bottom\" )\r\n        .selectAll( \".tick > text\" )\r\n        .attr( \"transform\", \"rotate(-45)\" )\r\n\r\n\r\n}\r\n\r\nconst calculateStacks = ( data, lastIndex ) => {\r\n    //Calculates stacks based on data descendants, return array of subgroup names, stack data for plotting, and colour function\r\n    let subgroups, stack, colour;\r\n\r\n    if( data.length === 0 ){\r\n        return {\r\n            stackedData: [],\r\n            subgroups: [],\r\n            colour: () => {}\r\n        }\r\n    }\r\n\r\n    if( data[0].children ){\r\n\r\n        subgroups = data[0].children.map( child => child.data.name );\r\n\r\n        stack = d3.stack()\r\n            .keys( subgroups )\r\n            .value( ( d, key ) => d.children.find( child => child.data.name === key ).value )\r\n\r\n    } else{\r\n\r\n        subgroups = [data[0].data.name];\r\n\r\n        stack = d3.stack()\r\n            .keys( subgroups )\r\n            .value( ( d, key ) => d.value )\r\n\r\n    }\r\n\r\n    colour = d3.scaleOrdinal()\r\n        .domain( subgroups )\r\n        .range( d3.schemeCategory10 )\r\n\r\n    return { stackedData: stack( data ), subgroups: subgroups, colour: colour }\r\n\r\n}\r\n","import React, { useState, useCallback, useRef } from 'react';\r\nimport { Spring } from 'react-spring/renderprops';\r\nimport { useGesture } from 'react-use-gesture';\r\nimport { useSpring, animated, config } from 'react-spring';\r\nimport * as d3 from 'd3';\r\nimport '../css/AppFrames.scss';\r\n\r\nexport const AppSidebar = ({children}) => {\r\n\r\n    return(\r\n        <div className=\"App_sidebar\">\r\n            {children}\r\n        </div>\r\n    )\r\n\r\n}\r\n\r\nexport const AppFrame = ({ children, vspan = 1, hspan = 1 }) => {\r\n\r\n    const [ maximised, _setMaximised ] = useState( false );\r\n    const [ style, setStyle ] = useSpring( () => ({ left: 0, top: 0, position: \"absolute\", config: config.stiff }) );\r\n    const childrenRef = useRef( null );\r\n\r\n    const setMaximised = val => {\r\n\r\n        _setMaximised( val );\r\n        const { left, top } = childrenRef.current.parentNode.getBoundingClientRect();\r\n        console.log( val )\r\n        setStyle({\r\n            from:{\r\n                left: val ? left : 0,\r\n                top: val ? top : 0,\r\n                position: \"fixed\"\r\n            },\r\n            to: {\r\n                left: val ? 0 : left,\r\n                top: val ? 0 : top,\r\n            },\r\n            onRest: () => style.position.value = val ? \"fixed\" : \"absolute\"\r\n\r\n        })\r\n\r\n    }\r\n\r\n    return (\r\n        <div className=\"App_sidebar_frame\">\r\n            <div id=\"layoutPlaceholder\" style={{width: \"100%\", height: \"100%\"}}/>\r\n            <animated.div ref={childrenRef} className={`App_frame_children${ maximised ? ' fullscreen' : ''}`} style={style}>\r\n                {children}\r\n            </animated.div>\r\n            <MaximiseButton maximised={maximised} setMaximised={setMaximised}/>\r\n        </div>\r\n    )\r\n}\r\n\r\nconst MaximiseButton = ({ maximised, setMaximised }) => {\r\n\r\n    const [ blend, setBlend ] = useState( 0 );\r\n    const path = useRef( null );\r\n\r\n    const bind = useGesture( {\r\n        onHover: ({hovering}) => { setBlend( hovering ? 1 : 0 ) },\r\n        onDragStart: () => setMaximised( !maximised )\r\n    })\r\n\r\n    const pathInterp = useCallback(\r\n        d3.interpolateString( `\r\n            M -10 0\r\n            L 0 0\r\n            L 0 10\r\n            M 0 10\r\n            L 0 0\r\n            L 10 0\r\n            M 10 0\r\n            L 0 0\r\n            L 0 -10\r\n            M 0 -10\r\n            L 0 0\r\n            L -10 0\r\n            `,\r\n            `\r\n            M -10 2\r\n            L -10 10\r\n            L -2 10\r\n            M 2 10\r\n            L 10 10\r\n            L 10 2\r\n            M 10 -2\r\n            L 10 -10\r\n            L 2 -10\r\n            M -2 -10\r\n            L -10 -10\r\n            L -10 -2\r\n        `)\r\n    , [] )\r\n\r\n    return (\r\n        <div className=\"Maximise_Button\">\r\n            <svg viewBox=\"0 0 30 30\">\r\n                <rect x=\"0\" y=\"0\" width=\"100%\" height=\"100%\" {...bind()}/>\r\n                <Spring from={{ t: blend === 0 ? 1 : 0 }} to={{ t: blend }} config={{ tension: 360, friction: 24 }}>\r\n                    {({ t }) => <animated.path ref={path} d={pathInterp( t )} transform=\"translate(15,15)\"/>}\r\n                </Spring>\r\n            </svg>\r\n        </div>\r\n    )\r\n\r\n}\r\n","import React, { useRef, useEffect } from 'react';\r\nimport { useSpring, animated } from 'react-spring';\r\nimport * as d3 from 'd3';\r\nimport '../css/LoadScreen.scss';\r\n\r\nexport const LoadScreen = ({loading}) => {\r\n\r\n    const props = useSpring( { from:{ opacity: loading ? 0 : 1 }, opacity: loading ? 1 : 0, delay: 1000 } );\r\n    const carRef = useRef( null );\r\n\r\n    useEffect( () => {\r\n\r\n        if( !carRef.current ) return;\r\n\r\n        const car = d3.select( carRef.current );\r\n\r\n        (function wheelRotation(){\r\n\r\n            if( props.opacity.value === 0 ) return;\r\n\r\n            car.selectAll( \"#load_car_wheel\" )\r\n                .attr( \"transform\", \"rotate(0)\" )\r\n                .transition()\r\n                .duration( 500 )\r\n                .ease( d3.easeLinear )\r\n                .attr( \"transform\", \"rotate(180)\" )\r\n                .on( \"end\", wheelRotation )\r\n\r\n        })();\r\n\r\n        (function carBob(){\r\n\r\n            if( props.opacity.value === 0 ) return;\r\n\r\n            car.selectAll( \"#load_car\" )\r\n                .attr( \"transform\", \"translate( 160, 195 )\" )\r\n                .transition()\r\n                .attr( \"transform\", \"translate( 160, 193 )\" )\r\n                .on( \"end\", carBob )\r\n\r\n        })();\r\n\r\n        (function smoke(){\r\n\r\n            if( props.opacity.value === 0 ) return;\r\n\r\n            car.selectAll( \"#load_car\" )\r\n                .transition( \"smokeLoop\" )\r\n                .duration( 200 )\r\n                .on( \"end\", smoke )\r\n\r\n            car.selectAll( \"#load_car\" )\r\n                .append( \"circle\" )\r\n                .attr( \"id\", \"load_car_smoke\" )\r\n                .attr( \"cx\", 10 )\r\n                .attr( \"cy\", 0 )\r\n                .attr( \"r\", 5 )\r\n                .attr( \"opacity\", 1 )\r\n                .transition()\r\n                .duration( 1000 )\r\n                .attr( \"cx\", -50*Math.random() - 50 )\r\n                .attr( \"cy\", -30*Math.random() - 30 )\r\n                .attr( \"r\", 50 )\r\n                .attr( \"opacity\", 0 )\r\n                .remove()\r\n\r\n        })();\r\n\r\n        function bushSlide(){\r\n\r\n            if( props.opacity.value === 0 ) return;\r\n\r\n            d3.select( this )\r\n                .attr( \"transform\", \"translate(700, 210)\")\r\n                .transition()\r\n                .ease( d3.easeLinear )\r\n                .duration( 4000*Math.random() + 2000 )\r\n                .attr( \"transform\", \"translate(-100, 210)\")\r\n                .on( \"end\", () => bushSlide.bind( this )() )\r\n\r\n        }\r\n\r\n        car.selectAll( \"#load_bush > g\" )\r\n            .each( bushSlide )\r\n\r\n    });\r\n\r\n    return (\r\n        <animated.div className=\"loadScreen\" style={props}>\r\n            <svg viewBox=\"0 0 600 214\" ref={carRef}>\r\n                <g id=\"load_road\">\r\n                    <rect x=\"0\" y=\"210\" width=\"100%\" height=\"2%\"/>\r\n                    <g id=\"load_bush\">\r\n                        <g id=\"load_bush--1\" transform=\"translate(50,210)\">\r\n                            <path d=\"M 0 0 a 30 30 0 0 1 0 -50 a 30 30 0 0 1 45 -10 v 60 Z\" fill=\"#4CA134\"/>\r\n                            <path d=\"M 44 -60 a 30 30 0 0 1 30 15 a 30 30 0 0 1 10 45 h -40 Z\" fill=\"#77BC1F\"/>\r\n                        </g>\r\n                        <g id=\"load_bush--2\" transform=\"translate(400,210)\">\r\n                            <path d=\"M 0 0 a 40 40 0 0 1 20 -50 a 40 40 0 0 1 40 -30 v 80 Z\" fill=\"#7C8F29\"/>\r\n                            <path d=\"M 59 -80 a 40 40 0 0 1 30 50 a 40 40 0 0 1 10 30 h -39 Z\" fill=\"#9BB53F\"/>\r\n                        </g>\r\n                    </g>\r\n                    <g id=\"load_cloud\">\r\n                        <line id=\"load_cloud--1\" x1=\"200\" x2=\"400\" y1=\"30\" y2=\"30\"/>\r\n                        <line id=\"load_cloud--2\" x1=\"240\" x2=\"500\" y1=\"40\" y2=\"40\"/>\r\n                    </g>\r\n                </g>\r\n                <g id=\"load_car_wheels\" transform=\"translate(223,193)\">\r\n                    <g id=\"load_car_wheel\">\r\n                        <circle r=\"18\" id=\"load_car_wheel_outer\"/>\r\n                        <circle r=\"10\" id=\"load_car_wheel_inner\"/>\r\n                        <path d=\"M -10 0 h 20 M 0 -10 v 20\"/>\r\n                        <path d=\"M -8 0 h 16 M 0 -8 v 16\" transform=\"rotate(45)\"/>\r\n                    </g>\r\n                    <use href=\"#load_car_wheel\" transform=\"translate(144,0)\"/>\r\n                </g>\r\n                <g id=\"load_car\">\r\n                    <path d={`M10-10\r\n                            q 5 -10 0 -27\r\n                            l 42 -3\r\n                            q 7 -1 5 -5 l -3 -17\r\n                            q 55 -10 105 -5\r\n                            q 3 0 17 25\r\n                            l 63 5\r\n                            q 5 5 0 20\r\n                            q 8 5 2 16\r\n                            h -13\r\n                            a 22 22 0 1 0 -42 10\r\n                            h -105\r\n                            a 20 20 0 1 0 -38 -6\r\n                            q -15 0 -20 -4\r\n                            Z`}/>\r\n                    <g id=\"load_car_windows\">\r\n                        <path d=\"M 67 -52 q -3 -4 4 -6 q 20 -3 30 -4 q 6 0 5 8 v 8 q 0 6 -5 6 h -20 q -5 0 -12 -10 Z\" />\r\n                        <path d=\"M 120 -62.5 l 28 0 v 22 h -33 q -2 0 -4 -5 v -13 q 0 -4 5 -4 Z\"/>\r\n                        <path d=\"M 148 -62.5 q 4 0 6 4 l 8 11 q 5 6 -1 7 h -13\"/>\r\n                    </g>\r\n                    <path d=\"M 13 -19 q 20 -3 100 -5 q 100 -1 118 -2 l 8 -10\" fill=\"none\" stroke=\"silver\"/>\r\n                </g>\r\n\r\n            </svg>\r\n            <h1>Loading data...</h1>\r\n        </animated.div>\r\n    )\r\n\r\n}\r\n","import React, { useState, useEffect, useReducer, useMemo, useCallback } from 'react';\r\nimport Mapbox from './components/js/Mapbox.js';\r\nimport { displayReducer } from './logic/Reducers.js';\r\nimport HierarchicalGraph from './components/js/HierarchicalGraph.js';\r\nimport { filterData, parseData } from './logic/DataLogic.js';\r\nimport { CountFilters } from './components/js/DataControls.js';\r\nimport { AppSidebar, AppFrame } from './components/js/AppFrame.js';\r\nimport { LoadScreen } from './components/js/LoadScreen.js';\r\nimport * as d3 from 'd3';\r\nimport './App.scss';\r\n\r\nexport default function App() {\r\n\r\n    const [ data, setData ] = useState( null );\r\n    const [ loading, setLoading ] = useState( false );\r\n    const [ display, setDisplay ] = useReducer( displayReducer,\r\n        {\r\n            filters: {},\r\n            sort: [\"\",\"\"],\r\n            hoveredCP: null,\r\n        }\r\n    )\r\n\r\n    useEffect( () => {\r\n\r\n        setLoading( true );\r\n        d3.csv( './devon.csv' )\r\n            .then( result => {\r\n\r\n                    const newData = parseData( result );\r\n                    setDisplay({\r\n                        type: 'setMulti',\r\n                        payload: {\r\n                            filters: {},\r\n                            sort: [\"date\",\"Ascending\"],\r\n                            view: [\"\",\"Total Vehicles\"],\r\n                            hoveredCP: null,\r\n                            focusedCP: null,\r\n                        }\r\n                    })\r\n                    setData( newData );\r\n                    setLoading( false );\r\n\r\n                }\r\n            )\r\n\r\n\r\n    }, [] )\r\n\r\n    const filteredData = useMemo( () => data && filterData( data, display.filters ), [data, display.filters] );\r\n    const countsFilter = useCallback( <CountFilters data={data} display={display} setDisplay={setDisplay}/>, [data, display.filters] );\r\n    const memoMap = useCallback( <Mapbox data={data} filteredData={filteredData} display={display} setDisplay={setDisplay}/>, [filteredData, data] );\r\n    const loadScreen = useCallback( <LoadScreen loading={loading}/>, [loading] );\r\n\r\n    return (\r\n        <div className=\"App\">\r\n            <header className=\"App_header\">\r\n                <h1>Devon Annual Average Daily Flows (AADFs)</h1>\r\n            </header>\r\n            <div className=\"page\">\r\n                {loadScreen}\r\n                {memoMap}\r\n                <AppSidebar>\r\n                    <AppFrame>\r\n                        <HierarchicalGraph data={filteredData} display={display} setDisplay={setDisplay}>\r\n                            {countsFilter}\r\n                        </HierarchicalGraph>\r\n                    </AppFrame>\r\n                    <AppFrame>\r\n                        <StreamGraph data={filteredData}/>\r\n                    </AppFrame>\r\n                </AppSidebar>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nconst StreamGraph = ({ data }) => {\r\n\r\n    useEffect( () => {\r\n    }, [data])\r\n\r\n    return (\r\n        <div className=\"StreamGraph\">\r\n            Graph of CP data by year, following the focused data from stacked bars\r\n        </div>\r\n    )\r\n}\r\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\nimport * as serviceWorker from './serviceWorker';\r\n\r\nReactDOM.render(<App />, document.getElementById('root'));\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n"],"sourceRoot":""}