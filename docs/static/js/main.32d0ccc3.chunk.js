(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{20:function(t,e,n){t.exports=n(40)},26:function(t,e,n){},27:function(t,e,n){},40:function(t,e,n){"use strict";n.r(e);var a=n(0),r=n.n(a),i=n(15),c=n.n(i),o=(n(26),n(5)),s=n(18),l=n(12),u=n.n(l),d=function(t){var e=t.data,n=t.setHoveredCP,i=t.setCP,c=Object(a.useState)(null),s=Object(o.a)(c,2),l=s[0],d=s[1],f=Object(a.useRef)(null);return function(t,e,n,r){var i=function(e){var a=new u.a.LngLat(e.lng.value,e.lat.value),i=(new u.a.Popup).setHTML('\n                    <div class="MapPopup">\n                        <h1>'.concat(e.road_name.value,"</h1>\n                        <h2>").concat(e.start_junction.value," - ").concat(e.end_junction.value,'</h2>\n                        <button id="onBtn" class="btn btn-sm">\n                            BeepBoop\n                        </button>\n                    </div>\n                ')),c=(new u.a.Marker).setLngLat(a).setPopup(i).addTo(t);c._element.addEventListener("mouseenter",function(){return r(e)}),c._element.addEventListener("mouseout",function(){return r(null)}),i.on("open",function(t){return console.log(t)||n(e)}),this.extend(a)};Object(a.useEffect)(function(){if(t&&e){var n=new u.a.LngLatBounds;e.markers.forEach(i,n),t.fitBounds(n,{padding:50,duration:0})}},[t,e])}(function(t){var e=t.accessToken,n=t.mapRef,r=(t.mapConfig,Object(a.useState)(null)),i=Object(o.a)(r,2),c=i[0],s=i[1];return Object(a.useEffect)(function(){if(n.current){u.a.accessToken=e;var t=new u.a.Map({container:n.current,style:"mapbox://styles/jridley246/cjxi67z0i42vy1cldfj812u8x"});s(t),t.addControl(new u.a.NavigationControl,"top-left")}},[e,n]),c}({accessToken:"pk.eyJ1IjoianJpZGxleTI0NiIsImEiOiJjanhpMzYxdXcxbWliNDFsN2g2bGg3ODg2In0.qqSDB24vCq0mdKUCdY4zgw",mapRef:f}),l,i,n),Object(a.useEffect)(function(){e&&d({zoom:12,markers:Object.values(e)})},[e]),r.a.createElement("div",{className:"Mapbox",ref:f})},f=n(10),m=n(2),h=function(t){var e=t.data,n=t.currentCP,i=t.currentYear,c=Object(a.useRef)(null);return Object(a.useEffect)(function(){if(e){var t=m.l(c.current),a=n?Object.values(n.counts):Object.values(e).map(function(t){return t.counts[i]});_(t,{barLabels:n?Object.keys(n.counts).map(function(t){return"'"+t.slice(-2)}):a.map(function(t){return t.parent.start_junction.value+"-"+t.parent.end_junction.value}),graphData:a.map(function(t){return t.vehicle_counts})})}},[e,n,i]),r.a.createElement("div",{className:"HierarchicalGraph"},r.a.createElement("svg",{className:"StackedBar",viewBox:"0 0 880 500",preserveAspectRatio:"xMinYMin",ref:c},r.a.createElement("rect",{className:"StackedBar_BG",x:"0",y:"0",width:"100%",height:"100%",fill:"#0000"}),r.a.createElement("g",{className:"StackedBar_Legend",transform:"translate( 760, 100 )"}),r.a.createElement("g",{className:"StackedBar_Axes"},r.a.createElement("g",{className:"StackedBar_Axes--Left",transform:"translate( 70, 0 )"}),r.a.createElement("g",{className:"StackedBar_Axes--Bottom",transform:"translate( 0, 480 )"})),r.a.createElement("g",{className:"StackedBar_Bars"})))},_=function t(e,n){var a=n.barLabels,r=n.graphData,i=n.lastIndex,c=n.route,o=function(n){m.c.preventDefault(),r[0].parent&&t(e,{barLabels:a,graphData:r.map(function(t){return t.parent}),lastIndex:n?n.index:0,route:"ascent"})};e.select(".StackedBar_BG").on("contextmenu click",o);var s,l,u,d=m.o().duration(500),h=function(t){t.transition().duration(50).attr("opacity",1)},_=function(t){t.transition().duration(100).attr("opacity",.2)};r[0].children?(s=r[0].children.map(function(t){return t.data.name}),l=m.n().keys(s).value(function(t,e){return t.children.find(function(t){return t.data.name===e}).value}),u=m.j().domain(m.g(s.length)).range(m.k)):(s=[r[0].data.name],l=m.n().keys(["value"]).value(function(t,e){return t.value}),u=function(){return m.k[i]});var p=l(r),b=Math.max.apply(Math,Object(f.a)(r.map(function(t){return t.value}))),w=m.h().domain(a).range([70,730]).padding([.2]),x=m.i().domain([0,1.1*b]).range([480,20]),j=[];e.selectAll(".StackedBar_Bars > .last").remove(),e.select(".current").attr("class","last").selectAll("g").each(function(t,e){if("descent"===c)e===i?m.l(this).selectAll("rect").each(function(t){j.push([+m.l(this).attr("y"),+m.l(this).attr("height")])}).attr("opacity",0):m.l(this).selectAll("rect").transition(d).attr("y",function(t){return x(e>i?2*b:-b)}).attr("opacity",0);else if("ascent"===c){var n=p.find(function(e){return e.key===t[0].data.data.name||e.key===t.key});if(!n)return;n=n.index,m.l(this).selectAll("rect").transition(d).attr("y",function(t,e){return x(p[n][e][1]-t[0])}).attr("height",function(t){return x(t[0])-x(t[1])}).attr("opacity",0)}else m.l(this).selectAll("rect").transition(d).attr("y",0).attr("height",0).attr("opacity",0)}),setTimeout(function(){return e.selectAll(".last").remove()},500),e.select(".StackedBar_Bars").append("g").attr("class","current").selectAll("g").data(p).join("g").attr("class",function(t){return t.key}).attr("fill",function(t){return u(t.index)}).on("mouseenter",function(t){var e=this;m.m(".current > g").filter(function(){return this!==e}).call(_),"value"!==t.key&&m.m(".StackedBar_Legend > g").call(_),m.l('.StackedBar_Legend > [id="'.concat(t.key,'"]')).call(h)}).on("mouseout",function(){var t=this;m.m(".current > g, .StackedBar_Legend > g").filter(function(){return this!==t}).call(h)}).on("click",function(n){n[0].data.children&&t(e,{barLabels:a,graphData:r.map(function(t){return t.children.find(function(t){return t.data.name===n.key})}),lastIndex:n.index,route:"descent"})}).on("contextmenu",o);var y=e.selectAll(".StackedBar_Bars > g.current > g").selectAll("rect").data(function(t){return t}).join("rect").attr("x",function(t,e){return w(a[e])}).attr("width",w.bandwidth()).attr("opacity",1);"descent"===c?y.each(function(t,e){var n=m.i().domain([0,1.1*b]).range([j[e][0]+j[e][1],j[e][0]]);m.l(this).attr("y",n(t[1])).attr("height",n(t[0])-n(t[1]))}):y.attr("y",function(t,e){return x(0)}),y.transition(d).attr("y",function(t){return x(t[1])}).attr("height",function(t){return x(t[0])-x(t[1])}),v(e,{seriesLabels:s.map(function(t,e){return{label:t,colour:u(e)}}).reverse()}),g(e,w,x)},v=function(t,e){var n=e.seriesLabels,a=t.select(".StackedBar_Legend"),r=m.o().duration(200),i=function(t){t.attr("x",100).attr("opacity",0).transition(r).attr("x",0).attr("opacity",1)},c=function(t){t.attr("x",0).attr("opacity",1).transition(r).attr("x",100).attr("opacity",0).on("end",function(){return t.remove()})},o=function(t,e){m.l(1===m.m(".StackedBar_Legend > g").size()?".value":'.current > [class="'.concat(t.label,'"]')).each(function(t,n){m.l(this).on(e).apply(this,[t,n])})},s=function(t){return o(t,"mouseenter")},l=function(t){return o(t,"mouseout")},u=function(t){return o(t,"click")},d=function(t){return o(t,"contextmenu")};a.selectAll("g").data(n,function(t){return t.label}).join(function(t){var e=t.append("g").attr("class","legend_entry").attr("id",function(t){return t.label}).attr("transform",function(t,e){return"translate( 0, ".concat(25*e," )")}).on("mouseenter",s).on("mouseout",l).on("click",u).on("contextmenu",d);e.append("circle").attr("cx","-12").attr("cy",-6).attr("r",10).attr("fill",function(t){return t.colour}).call(i),e.append("text").text(function(t){return t.label}).attr("fill",function(t){return t.colour}).call(i)},function(t){t.selectAll("g").transition(r).attr("transform",function(t,e){return"translate( 0, ".concat(25*e," )")}),t.select("text").call(c),t.append("text").text(function(t){return t.label}).attr("fill",function(t){return t.colour}).call(i),t.select("circle").call(i).transition(r).attr("fill",function(t){return t.colour})},function(t){t.selectAll("text, circle").call(c).transition(r).on("end",function(){return t.remove()})})},g=function(t,e,n){var a=t.select(".StackedBar_Axes");a.select(".StackedBar_Axes--Left").transition().call(m.b(n).tickSize(-660)),a.select(".StackedBar_Axes--Bottom").transition().call(m.a(e))},p=function(t){var e={};return t.data.forEach(function(t){var n=e[t.count_point_id]||new b({road_name:t.road_name,id:t.count_point_id,road_cat:t.road_category,lat:+t.latitude,lng:+t.longitude,region_id:t.region_id,authority_id:+t.local_authority_id,link_length:+t.link_length_km,start_junction:t.start_junction_road_name,end_junction:t.end_junction_road_name});e[t.count_point_id]=n,e[t.count_point_id].counts[t.year]=new w({parent:e[t.count_point_id],year:t.year,method:t.estimation_method,sum_motor_vehicles:t.all_motor_vehicles,sum_hgvs:t.all_hgvs,sum_bus_coach:t.buses_and_coaches,sum_cars_taxis:t.cars_and_taxis,sum_lgvs:t.lgvs,hgvs:{sum_hgv_2_rigid:t.hgvs_2_rigid_axle,sum_hgv_3_artic:t.hgvs_3_or_4_articulated_axle,sum_hgv_3_rigid:t.hgvs_3_rigid_axle,sum_hgv_4_rigid:t.hgvs_4_or_more_rigid_axle,sum_hgv_5_artic:t.hgvs_5_articulated_axle,sum_hgv_6_artic:t.hgvs_6_articulated_axle},twowheels:{push:t.pedal_cycles,motor:t.two_wheeled_motor_vehicles}})}),e};function b(t){var e=t.road_name,n=t.id,a=(t.road_type,t.road_cat),r=t.lat,i=t.lng,c=t.region_id,o=t.authority_id,s=t.link_length,l=t.start_junction,u=t.end_junction;this.road_name=new x("Road Name","Name of the road",e),this.id=new x("Count Point ID","",n),this.road_cat=new x("Road Category","Classification of the road type",a),this.lat=new x("Latitude","Latitude of the Count Point",r),this.lng=new x("Longitude","Longitude of the Count Point",i),this.region_id=new x("Region ID","",c),this.authority_id=new x("Local Authority ID","",o),this.link_length=new x("Link Length","Total length of the network road link for this Count Point",s),this.start_junction=new x("Start Junction Name","The road name of the start junction of the link",l),this.end_junction=new x("End Junction Name","The road name of the end junction of the link",u),this.counts={}}function w(t){var e=t.parent,n=t.year,a=t.method,r=t.sum_motor_vehicles,i=t.sum_hgvs,c=t.sum_bus_coach,o=t.sum_cars_taxis,s=t.sum_lgvs,l=t.hgvs,u=l.sum_hgv_2_rigid,d=l.sum_hgv_3_artic,f=l.sum_hgv_3_rigid,h=l.sum_hgv_4_rigid,_=l.sum_hgv_5_artic,v=l.sum_hgv_6_artic,g=t.twowheels,p=g.push,b=g.motor;this.parent=e,this.year=new x("AADF Year","AADFs are shown for each year from 2000 onwards",n),this.isEstimated=new x("Is Estimated?","Sometimes the vehicle count is estimated","Estimated"===a),this.vehicle_counts=m.d({name:"Total Vehicles",value:r,children:[new x("HGVs","",i,[new x("Two-rigid axle HGVs","",u),new x("Three-articulated axle HGVs","",d),new x("Three-rigid axle HGVs","",f),new x("Four-rigid axle HGVs","",h),new x("Five-articulated axle HGVs","",_),new x("Six-articulated axle HGVs","",v)]),new x("Two-Wheeled Vehicles","",p+b,[new x("Pedal Cycles","",p),new x("Two-Wheeled Motor Vehicles","",b)]),new x("Buses and Coaches","",c),new x("Cars and Taxis","",o),new x("LGVs","",s)]})}function x(t,e,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];this.name=t,this.description=e,this.value=n,this.children=a}var j=n(14),y=n(19);n(27);var k=function(t){var e=t.children,n=t.vspan,i=void 0===n?1:n,c=(t.hspan,Object(a.useState)(50)),s=Object(o.a)(c,2),l=s[0],u=s[1],d=Object(a.useState)(!1),f=Object(o.a)(d,2),m=f[0],h=f[1],_=Object(j.c)(function(){return{left:0,top:0,position:"absolute",config:j.b.stiff}}),v=Object(o.a)(_,2),g=v[0],p=v[1],b=function(){u(window.innerWidth<800?100:50)},w=Object(a.useRef)(null);Object(a.useEffect)(function(){return window.addEventListener("resize",b),function(){return window.removeEventListener("resize",b)}},[]);return r.a.createElement("div",{className:"App_frame",style:{minWidth:"400px",height:50*i+"%",width:l+"%"}},r.a.createElement("div",{id:"layoutPlaceholder",style:{width:"100%",height:"100%"}}),r.a.createElement(j.a.div,{ref:w,className:"App_frame_children".concat(m?" fullscreen":""),style:g},e),r.a.createElement(E,{maximised:m,setMaximised:function(t){h(t);var e=w.current.parentNode.getBoundingClientRect(),n=e.left,a=e.top;console.log(t),p({from:{left:t?n:0,top:t?a:0,position:"fixed"},to:{left:t?0:n,top:t?0:a},onRest:function(){return g.position.value=t?"fixed":"absolute"}})}}))},E=function(t){var e=t.maximised,n=t.setMaximised,i=Object(a.useState)(0),c=Object(o.a)(i,2),l=c[0],u=c[1],d=Object(a.useRef)(null),f=Object(s.a)({onHover:function(t){var e=t.hovering;u(e?1:0)},onDragStart:function(){return n(!e)}}),h=Object(a.useCallback)(m.e("\n            M -10 0\n            L 0 0\n            L 0 10\n            M 0 10\n            L 0 0\n            L 10 0\n            M 10 0\n            L 0 0\n            L 0 -10\n            M 0 -10\n            L 0 0\n            L -10 0\n            ","\n            M -10 2\n            L -10 10\n            L -2 10\n            M 2 10\n            L 10 10\n            L 10 2\n            M 10 -2\n            L 10 -10\n            L 2 -10\n            M -2 -10\n            L -10 -10\n            L -10 -2\n        "),[]);return r.a.createElement("div",{className:"Maximise_Button"},r.a.createElement("svg",{viewBox:"0 0 30 30"},r.a.createElement("rect",Object.assign({x:"0",y:"0",width:"100%",height:"100%"},f())),r.a.createElement(y.Spring,{from:{t:0===l?1:0},to:{t:l},config:{tension:360,friction:24}},function(t){var e=t.t;return r.a.createElement("path",{ref:d,d:h(e),transform:"translate(15,15)"})})))},L=function(t){var e=t.data;return Object(a.useEffect)(function(){},[e]),r.a.createElement("div",{className:"Readout"})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(function(){var t=Object(a.useState)(null),e=Object(o.a)(t,2),n=e[0],i=e[1],c=Object(a.useState)(null),s=Object(o.a)(c,2),l=s[0],u=s[1],f=Object(a.useState)(null),_=Object(o.a)(f,2),v=(_[0],_[1]),g=Object(a.useState)(2e3),b=Object(o.a)(g,2),w=b[0],x=b[1];Object(a.useEffect)(function(){m.f("./devon.json").then(function(t){var e=p(t);i(e),x(2e3),u(null)})},[]);var j=Object(a.useCallback)(r.a.createElement(d,{data:n,setHoveredCP:v,setCP:u}),[n]);return r.a.createElement("div",{className:"App"},r.a.createElement("header",{className:"App_header"},r.a.createElement("h1",null,"Devon Annual Average Daily Flows (AADFs)")),r.a.createElement("div",{className:"App_frames"},r.a.createElement(k,{vspan:2},j),r.a.createElement(k,null,r.a.createElement(h,{data:n,currentCP:l,currentYear:w,setHoveredCP:v})),r.a.createElement(k,null,r.a.createElement(L,{data:n}))))},null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(t){t.unregister()})}},[[20,1,2]]]);
//# sourceMappingURL=main.32d0ccc3.chunk.js.map