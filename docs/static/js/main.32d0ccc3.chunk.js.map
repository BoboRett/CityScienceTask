{"version":3,"sources":["components/js/Mapbox.js","components/js/Hooks.js","components/js/HierarchicalGraph.js","components/js/DataLogic.js","App.js","serviceWorker.js","index.js"],"names":["Mapbox","_ref","data","setHoveredCP","setCP","_useState","useState","_useState2","Object","slicedToArray","mapConfig","setMapConfig","map","useRef","mapbox","addMarker","marker","pos","mapboxgl","LngLat","lng","value","lat","popup","Popup","setHTML","concat","road_name","start_junction","end_junction","_marker","Marker","setLngLat","setPopup","addTo","_element","addEventListener","on","ev","console","log","this","extend","useEffect","bounds","LngLatBounds","markers","forEach","fitBounds","padding","duration","useMap","accessToken","mapRef","setMapbox","current","Map","container","style","addControl","NavigationControl","useMapbox","zoom","values","react_default","a","createElement","className","ref","HierarchicalGraph","currentCP","currentYear","frame","graph","d3","graphData","counts","datum","drawStacks","barLabels","keys","year","slice","parent","vehicle_counts","viewBox","preserveAspectRatio","x","y","width","height","fill","transform","_ref2","lastIndex","route","goUp","d","preventDefault","index","select","subgroups","stack","colour","t","t_fadeIn","selection","transition","attr","t_fadeOut","children","child","name","key","find","domain","length","range","stackedData","max","Math","apply","toConsumableArray","parentBounds","selectAll","remove","each","_d","i","push","indexInParent","j","setTimeout","append","join","activeEl","filter","call","newStacks","bandwidth","tmp_y","drawLegend","seriesLabels","group","label","reverse","drawAxes","_ref3","t_slideIn","t_slideOut","triggerEvent","event","size","onMove","onOut","onClick","onContext","enter","grp","text","update","exit","tickSize","parseData","fetchResult","countPoint","count_point_id","CountPoint","id","road_cat","road_category","latitude","longitude","region_id","authority_id","local_authority_id","link_length","link_length_km","start_junction_road_name","end_junction_road_name","Count","method","estimation_method","sum_motor_vehicles","all_motor_vehicles","sum_hgvs","all_hgvs","sum_bus_coach","buses_and_coaches","sum_cars_taxis","cars_and_taxis","sum_lgvs","lgvs","hgvs","sum_hgv_2_rigid","hgvs_2_rigid_axle","sum_hgv_3_artic","hgvs_3_or_4_articulated_axle","sum_hgv_3_rigid","hgvs_3_rigid_axle","sum_hgv_4_rigid","hgvs_4_or_more_rigid_axle","sum_hgv_5_artic","hgvs_5_articulated_axle","sum_hgv_6_artic","hgvs_6_articulated_axle","twowheels","pedal_cycles","motor","two_wheeled_motor_vehicles","road_type","Property","_ref2$hgvs","_ref2$twowheels","isEstimated","description","arguments","undefined","AppFrame","_ref$vspan","vspan","_useState9","hspan","_useState10","setWidth","_useState11","_useState12","maximised","_setMaximised","_useSpring","useSpring","left","top","position","config","stiff","_useSpring2","setStyle","onResize","window","innerWidth","childrenRef","removeEventListener","minWidth","react_spring_web","div","App_MaximiseButton","setMaximised","val","_childrenRef$current$","parentNode","getBoundingClientRect","from","to","onRest","MaximiseButton","_useState13","_useState14","blend","setBlend","path","bind","useGesture","onHover","hovering","onDragStart","pathInterp","useCallback","assign","renderprops","tension","friction","_ref4","Readout","_ref5","Boolean","location","hostname","match","ReactDOM","render","setData","_useState3","_useState4","_useState5","_useState6","_useState7","_useState8","setYear","then","result","newData","memoMap","js_Mapbox","App_AppFrame","js_HierarchicalGraph","App_Readout","document","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.32d0ccc3.chunk.js","sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\r\nimport { useMapbox, useMap } from './Hooks.js';\r\n//import mapboxgl from 'mapbox-gl';\r\n\r\nconst Mapbox = ({ data, setHoveredCP, setCP }) => {\r\n\r\n    const [ mapConfig, setMapConfig ] = useState( null );\r\n    const map = useRef( null );\r\n\r\n    const Map = useMapbox({\r\n        accessToken: 'pk.eyJ1IjoianJpZGxleTI0NiIsImEiOiJjanhpMzYxdXcxbWliNDFsN2g2bGg3ODg2In0.qqSDB24vCq0mdKUCdY4zgw',\r\n        mapRef: map,\r\n    } );\r\n\r\n    useMap( Map, mapConfig, setCP, setHoveredCP );\r\n\r\n    useEffect( () => {\r\n\r\n        if( !data ) return;\r\n\r\n        setMapConfig({\r\n            zoom: 12,\r\n            markers: Object.values( data ),\r\n        })\r\n\r\n    }, [data])\r\n\r\n    return (\r\n        <div className=\"Mapbox\" ref={map}/>\r\n    )\r\n\r\n}\r\n\r\nexport default Mapbox\r\n","import { useEffect, useState, useCallback } from 'react';\r\nimport mapboxgl from 'mapbox-gl';\r\n\r\nconst useMapbox = ({ accessToken, mapRef, mapConfig }) => {\r\n\r\n    const [ mapbox, setMapbox ] = useState( null );\r\n\r\n    useEffect( () => {\r\n\r\n        if( !mapRef.current ) return;\r\n\r\n        mapboxgl.accessToken = accessToken;\r\n\r\n        const map = new mapboxgl.Map({\r\n            container: mapRef.current,\r\n            style: 'mapbox://styles/jridley246/cjxi67z0i42vy1cldfj812u8x',\r\n        })\r\n\r\n        setMapbox( map )\r\n\r\n        map.addControl( new mapboxgl.NavigationControl(), 'top-left' );\r\n\r\n    }, [ accessToken, mapRef ])\r\n\r\n    return mapbox\r\n\r\n}\r\n\r\nconst useMap = ( mapbox, mapConfig, setCP, setHoveredCP ) => {\r\n\r\n    const addMarker = function( marker ){\r\n\r\n        const pos = new mapboxgl.LngLat( marker.lng.value, marker.lat.value );\r\n\r\n        const popup = new mapboxgl.Popup()\r\n            .setHTML(`\r\n                    <div class=\"MapPopup\">\r\n                        <h1>${marker.road_name.value}</h1>\r\n                        <h2>${marker.start_junction.value} - ${marker.end_junction.value}</h2>\r\n                        <button id=\"onBtn\" class=\"btn btn-sm\">\r\n                            BeepBoop\r\n                        </button>\r\n                    </div>\r\n                `)\r\n\r\n        const _marker = new mapboxgl.Marker()\r\n            .setLngLat( pos )\r\n            .setPopup( popup )\r\n            .addTo( mapbox )\r\n\r\n        _marker._element.addEventListener( \"mouseenter\", () => setHoveredCP( marker ) );\r\n        _marker._element.addEventListener( \"mouseout\", () => setHoveredCP( null ) );\r\n        popup.on( \"open\", ev => console.log( ev ) || setCP( marker ) );\r\n\r\n        this.extend( pos );\r\n\r\n    }\r\n\r\n    useEffect( () => {\r\n\r\n        if( !mapbox || !mapConfig ) return\r\n\r\n        const bounds = new mapboxgl.LngLatBounds();\r\n\r\n        mapConfig.markers.forEach( addMarker, bounds );\r\n        mapbox.fitBounds( bounds, {\r\n            padding: 50,\r\n            duration: 0\r\n        });\r\n\r\n    }, [ mapbox, mapConfig ] )\r\n\r\n}\r\n\r\nexport { useMap, useMapbox };\r\n","import React, { useEffect, useRef } from 'react';\r\nimport * as d3 from 'd3';\r\n\r\nconst HierarchicalGraph = ({ data, currentCP, currentYear }) => {\r\n\r\n    const frame = useRef( null );\r\n\r\n    useEffect( () => {\r\n\r\n        if( !data ) return;\r\n\r\n        const graph = d3.select( frame.current );\r\n        const graphData = !currentCP ? Object.values( data ).map( datum => datum.counts[currentYear] ) : Object.values( currentCP.counts );\r\n\r\n        drawStacks( graph, {\r\n            barLabels: currentCP ? Object.keys( currentCP.counts ).map( year => \"'\" + year.slice( -2 ) ) : graphData.map( datum => datum.parent.start_junction.value + \"-\" + datum.parent.end_junction.value ),\r\n            graphData: graphData.map( datum => datum.vehicle_counts )\r\n        })\r\n\r\n    }, [data, currentCP, currentYear])\r\n\r\n    return (\r\n        <div className=\"HierarchicalGraph\">\r\n            <svg className=\"StackedBar\" viewBox=\"0 0 880 500\" preserveAspectRatio=\"xMinYMin\" ref={frame}>\r\n                <rect className=\"StackedBar_BG\" x=\"0\" y=\"0\" width=\"100%\" height=\"100%\" fill=\"#0000\"/>\r\n                <g className=\"StackedBar_Legend\" transform=\"translate( 760, 100 )\"/>\r\n                <g className=\"StackedBar_Axes\">\r\n                    <g className=\"StackedBar_Axes--Left\" transform=\"translate( 70, 0 )\"/>\r\n                    <g className=\"StackedBar_Axes--Bottom\" transform=\"translate( 0, 480 )\"/>\r\n                </g>\r\n                <g className=\"StackedBar_Bars\"/>\r\n            </svg>\r\n        </div>\r\n    )\r\n}\r\n\r\n\r\nexport default HierarchicalGraph;\r\n\r\n\r\nconst drawStacks = ( graph, { barLabels, graphData, lastIndex, route } ) => {\r\n\r\n    //Navigation functions\r\n    const drillDown = d => {\r\n\r\n        if( d[0].data.children ){\r\n\r\n            drawStacks( graph, {\r\n                barLabels: barLabels,\r\n                graphData: graphData.map( datum => datum.children.find( child => child.data.name === d.key ) ),\r\n                lastIndex: d.index,\r\n                route: \"descent\",\r\n            })\r\n\r\n        }\r\n\r\n    }\r\n\r\n    const goUp = d => {\r\n\r\n        d3.event.preventDefault();\r\n\r\n        if( graphData[0].parent ){\r\n\r\n            drawStacks( graph, {\r\n                barLabels: barLabels,\r\n                graphData: graphData.map( datum => datum.parent ),\r\n                lastIndex: d ? d.index : 0,\r\n                route: \"ascent\"\r\n            })\r\n\r\n        }\r\n\r\n    }\r\n\r\n    graph.select( \".StackedBar_BG\" ).on( \"contextmenu click\", goUp );\r\n\r\n    //Animations\r\n    const t = d3.transition()\r\n        .duration( 500 )\r\n    const t_fadeIn = selection => {\r\n        selection\r\n            .transition()\r\n            .duration( 50 )\r\n            .attr( \"opacity\", 1 )\r\n    }\r\n    const t_fadeOut = selection => {\r\n        selection\r\n            .transition()\r\n            .duration( 100 )\r\n            .attr( \"opacity\", 0.2 )\r\n    }\r\n\r\n    //Calculates stacks based on data descendants\r\n    let subgroups, stack, colour;\r\n\r\n    if( graphData[0].children ){\r\n\r\n        subgroups = graphData[0].children.map( child => child.data.name );\r\n\r\n        stack = d3.stack()\r\n            .keys( subgroups )\r\n            .value( ( d, key ) => d.children.find( child => child.data.name === key ).value )\r\n\r\n        colour = d3.scaleOrdinal()\r\n            .domain( d3.range( subgroups.length ) )\r\n            .range( d3.schemeCategory10 )\r\n\r\n    } else{\r\n\r\n        subgroups = [graphData[0].data.name];\r\n\r\n        stack = d3.stack()\r\n            .keys( [\"value\"] )\r\n            .value( ( d, key ) => d.value )\r\n\r\n        colour = () => d3.schemeCategory10[lastIndex];\r\n\r\n    }\r\n\r\n    const stackedData = stack( graphData );\r\n    const max = Math.max( ...graphData.map( datum => datum.value ) );\r\n\r\n    //Scales\r\n    const x = d3.scaleBand()\r\n        .domain( barLabels )\r\n        .range( [ 70, 730 ] )\r\n        .padding( [0.2] )\r\n\r\n    const y = d3.scaleLinear()\r\n        .domain( [ 0, max*1.1 ] )\r\n        .range( [ 480, 20 ] )\r\n\r\n    //If descending, initial [y0, y1] of parent rects for transition\r\n    const parentBounds = [];\r\n\r\n    //--------------------\r\n    //Stacks\r\n\r\n    //Event handlers\r\n    const onMove = function( d ){\r\n\r\n        const activeEl = this;\r\n        d3.selectAll( \".current > g\" ).filter( function(){ return this !== activeEl } ).call( t_fadeOut );\r\n\r\n        d.key !== \"value\" && d3.selectAll( \".StackedBar_Legend > g\" ).call( t_fadeOut );\r\n        d3.select( `.StackedBar_Legend > [id=\"${d.key}\"]` ).call( t_fadeIn );\r\n\r\n    }\r\n    const onOut = function(){\r\n\r\n        const activeEl = this;\r\n        d3.selectAll( \".current > g, .StackedBar_Legend > g\" ).filter( function(){ return this !== activeEl } ).call( t_fadeIn );\r\n\r\n    }\r\n\r\n    //Clean up old groups if traversing quickly\r\n    graph.selectAll( \".StackedBar_Bars > .last\" ).remove();\r\n\r\n    //Transition out old groups\r\n    graph.select( \".current\" ).attr( \"class\", \"last\" ).selectAll( \"g\" )\r\n        .each( function( _d, i ){\r\n\r\n            if( route === \"descent\" ){\r\n\r\n                if( i === lastIndex ){\r\n\r\n                    d3.select( this ).selectAll( \"rect\" )\r\n                        .each( function( d ){ parentBounds.push( [ +d3.select( this ).attr( \"y\" ), +d3.select( this ).attr( \"height\" ) ] ) } )\r\n                        .attr( \"opacity\", 0 )\r\n\r\n                } else{\r\n\r\n                    d3.select( this ).selectAll( \"rect\" )\r\n                        .transition( t )\r\n                        .attr( \"y\", d => i > lastIndex ? y( max*2 ) : y( -max ) )\r\n                        .attr( \"opacity\", 0 )\r\n\r\n                }\r\n\r\n            } else if( route === \"ascent\" ){\r\n\r\n                //When ascending, must determine position in parent's children for transition\r\n                let indexInParent = stackedData.find( datum => datum.key === _d[0].data.data.name || datum.key === _d.key );\r\n\r\n                if( !indexInParent ) return;\r\n\r\n                indexInParent = indexInParent.index;\r\n\r\n                d3.select( this ).selectAll( \"rect\" )\r\n                    .transition( t )\r\n                    .attr( \"y\", ( d, j ) => y( stackedData[indexInParent][j][1] - d[0] ) )\r\n                    .attr( \"height\", d => y( d[0] ) - y( d[1] ) )\r\n                    .attr( \"opacity\", 0 )\r\n\r\n            } else{\r\n\r\n                d3.select( this ).selectAll( \"rect\" )\r\n                    .transition( t )\r\n                    .attr( \"y\", 0 )\r\n                    .attr( \"height\", 0 )\r\n                    .attr( \"opacity\", 0 )\r\n\r\n            }\r\n\r\n        })\r\n\r\n    setTimeout( () => graph.selectAll( \".last\" ).remove(), 500 );\r\n\r\n    //Add new stack groups\r\n    graph.select( \".StackedBar_Bars\" ).append( \"g\" ).attr( \"class\", \"current\" ).selectAll( \"g\" ).data( stackedData )\r\n        .join( \"g\" )\r\n            .attr( \"class\", d => d.key )\r\n            .attr( \"fill\", d => colour( d.index ) )\r\n            .on( \"mouseenter\", onMove )\r\n            .on( \"mouseout\", onOut )\r\n            .on( \"click\", drillDown )\r\n            .on( \"contextmenu\", goUp )\r\n\r\n    //Bars\r\n    const newStacks = graph.selectAll( \".StackedBar_Bars > g.current > g\" ).selectAll( \"rect\" ).data( d => d )\r\n        .join( \"rect\" )\r\n            .attr( \"x\", ( d, i ) => x( barLabels[i] ) )\r\n            .attr( \"width\", x.bandwidth() )\r\n            .attr( \"opacity\", 1 )\r\n\r\n    if( route === \"descent\" ){\r\n\r\n        newStacks\r\n            .each( function( d, i ){\r\n                const tmp_y = d3.scaleLinear()\r\n                    .domain( [ 0, max*1.1 ] )\r\n                    .range( [ parentBounds[i][0] + parentBounds[i][1], parentBounds[i][0] ] )\r\n\r\n                d3.select( this )\r\n                    .attr( \"y\", tmp_y( d[1] ) )\r\n                    .attr( \"height\", tmp_y( d[0] ) - tmp_y( d[1] ) )\r\n            })\r\n\r\n    } else{\r\n\r\n        newStacks\r\n            .attr( \"y\", ( d, i ) => y( 0 ) )\r\n\r\n    }\r\n\r\n    newStacks\r\n        .transition( t )\r\n        .attr( \"y\", d => y( d[1] ) )\r\n        .attr( \"height\", d => y( d[0] ) - y( d[1] ) )\r\n\r\n\r\n    //Update legend\r\n    drawLegend( graph, {\r\n        seriesLabels: subgroups.map( ( group, i ) => ({ label: group, colour: colour( i ) }) ).reverse()\r\n    })\r\n\r\n    //Update Axes\r\n    drawAxes( graph, x, y );\r\n\r\n}\r\n\r\nconst drawLegend = ( graph, { seriesLabels } ) => {\r\n\r\n    const frame = graph.select( \".StackedBar_Legend\" );\r\n\r\n    //Animations\r\n    const t = d3.transition().duration( 200 )\r\n    const t_slideIn = function( selection ){\r\n\r\n        selection\r\n            .attr( \"x\", 100 )\r\n            .attr( \"opacity\", 0 )\r\n            .transition( t )\r\n            .attr( \"x\", 0 )\r\n            .attr( \"opacity\", 1 )\r\n\r\n    }\r\n    const t_slideOut = function( selection ){\r\n\r\n        selection\r\n            .attr( \"x\", 0 )\r\n            .attr( \"opacity\", 1 )\r\n            .transition( t )\r\n            .attr( \"x\", 100 )\r\n            .attr( \"opacity\", 0 )\r\n            .on( \"end\", () => selection.remove() )\r\n\r\n    }\r\n    const t_fadeIn = selection => {\r\n        selection\r\n            .transition()\r\n            .duration( 50 )\r\n            .attr( \"opacity\", 1 )\r\n    }\r\n    const t_fadeOut = selection => {\r\n        selection\r\n            .transition()\r\n            .duration( 100 )\r\n            .attr( \"opacity\", 0.2 )\r\n    }\r\n\r\n    //Event Handlers\r\n    const triggerEvent = ( d, event ) => {\r\n        d3.select( d3.selectAll( \".StackedBar_Legend > g\" ).size() === 1 ? \".value\" : `.current > [class=\"${d.label}\"]` )\r\n            .each( function( d, i ){\r\n                d3.select( this ).on( event ).apply( this, [ d, i ] )\r\n            })\r\n    }\r\n    const onMove = d => triggerEvent( d, \"mouseenter\" );\r\n    const onOut = d => triggerEvent( d, \"mouseout\" );\r\n    const onClick = d => triggerEvent( d, \"click\" );\r\n    const onContext = d => triggerEvent( d, \"contextmenu\" );\r\n\r\n    //Enter, update, exit\r\n    frame.selectAll( \"g\" ).data( seriesLabels, d => d.label ).join(\r\n        enter => {\r\n\r\n            const grp = enter.append( \"g\" )\r\n                .attr( \"class\", \"legend_entry\" )\r\n                .attr( \"id\", d => d.label )\r\n                .attr( \"transform\", ( d, i ) => `translate( 0, ${i*25} )` )\r\n                .on( \"mouseenter\", onMove )\r\n                .on( \"mouseout\", onOut )\r\n                .on( \"click\", onClick )\r\n                .on( \"contextmenu\", onContext )\r\n\r\n            grp.append( \"circle\" )\r\n                .attr( \"cx\", \"-12\" )\r\n                .attr( \"cy\", -6 )\r\n                .attr( \"r\", 10 )\r\n                .attr( \"fill\", d => d.colour )\r\n                .call( t_slideIn )\r\n\r\n            grp.append( \"text\" )\r\n                .text( d => d.label )\r\n                .attr( \"fill\", d => d.colour )\r\n                .call( t_slideIn )\r\n\r\n        },\r\n        update => {\r\n\r\n            update.selectAll( \"g\" )\r\n                .transition( t )\r\n                .attr( \"transform\", ( d, i ) => `translate( 0, ${i*25} )` )\r\n\r\n            update.select( \"text\" ).call( t_slideOut )\r\n\r\n            update.append( \"text\" )\r\n                .text( d => d.label )\r\n                .attr( \"fill\", d => d.colour )\r\n                .call( t_slideIn )\r\n\r\n            update.select( \"circle\" )\r\n                .call( t_slideIn )\r\n                .transition( t )\r\n                .attr( \"fill\", d => d.colour )\r\n\r\n        },\r\n        exit => {\r\n            exit\r\n                .selectAll( \"text, circle\" )\r\n                .call( t_slideOut )\r\n                .transition( t )\r\n                .on( \"end\", () => exit.remove() )\r\n        }\r\n    )\r\n\r\n}\r\n\r\nconst drawAxes = ( graph, x, y ) => {\r\n\r\n    const frame = graph.select( \".StackedBar_Axes\" )\r\n\r\n    frame.select( \".StackedBar_Axes--Left\" )\r\n        .transition()\r\n        .call( d3.axisLeft( y ).tickSize( -660 ) )\r\n\r\n    frame.select( \".StackedBar_Axes--Bottom\" )\r\n        .transition()\r\n        .call( d3.axisBottom( x ) )\r\n\r\n}\r\n","import * as d3 from 'd3';\r\n\r\nexport const parseData = fetchResult => {\r\n\r\n    const data = {};\r\n\r\n    fetchResult.data.forEach( datum => {\r\n\r\n        const countPoint = data[datum.count_point_id] || new CountPoint({\r\n            road_name: datum.road_name,\r\n            id: datum.count_point_id,\r\n            road_cat: datum.road_category,\r\n            lat: +datum.latitude,\r\n            lng: +datum.longitude,\r\n            region_id: datum.region_id,\r\n            authority_id: +datum.local_authority_id,\r\n            link_length: +datum.link_length_km,\r\n            start_junction: datum.start_junction_road_name,\r\n            end_junction: datum.end_junction_road_name\r\n        });\r\n\r\n        data[datum.count_point_id] = countPoint;\r\n\r\n        data[datum.count_point_id].counts[datum.year] = new Count({\r\n            parent: data[datum.count_point_id],\r\n            year: datum.year,\r\n            method: datum.estimation_method,\r\n            sum_motor_vehicles: datum.all_motor_vehicles,\r\n            sum_hgvs: datum.all_hgvs,\r\n            sum_bus_coach: datum.buses_and_coaches,\r\n            sum_cars_taxis: datum.cars_and_taxis,\r\n            sum_lgvs: datum.lgvs,\r\n            hgvs: {\r\n                sum_hgv_2_rigid: datum.hgvs_2_rigid_axle,\r\n                sum_hgv_3_artic: datum.hgvs_3_or_4_articulated_axle,\r\n                sum_hgv_3_rigid: datum.hgvs_3_rigid_axle,\r\n                sum_hgv_4_rigid: datum.hgvs_4_or_more_rigid_axle,\r\n                sum_hgv_5_artic: datum.hgvs_5_articulated_axle,\r\n                sum_hgv_6_artic: datum.hgvs_6_articulated_axle,\r\n            },\r\n            twowheels: {\r\n                push: datum.pedal_cycles,\r\n                motor: datum.two_wheeled_motor_vehicles,\r\n            }\r\n        })\r\n\r\n    })\r\n\r\n    return data\r\n\r\n}\r\n\r\nfunction CountPoint({ road_name, id, road_type, road_cat, lat, lng, region_id, authority_id, link_length, start_junction, end_junction }) {\r\n    this.road_name = new Property( \"Road Name\", \"Name of the road\", road_name );\r\n    this.id = new Property( \"Count Point ID\", \"\", id );\r\n    this.road_cat = new Property( \"Road Category\", \"Classification of the road type\", road_cat );\r\n    this.lat = new Property( \"Latitude\", \"Latitude of the Count Point\", lat );\r\n    this.lng = new Property( \"Longitude\", \"Longitude of the Count Point\", lng );\r\n    this.region_id = new Property( \"Region ID\", \"\", region_id );\r\n    this.authority_id = new Property( \"Local Authority ID\", \"\", authority_id );\r\n    this.link_length = new Property( \"Link Length\", \"Total length of the network road link for this Count Point\", link_length );\r\n    this.start_junction = new Property( \"Start Junction Name\", \"The road name of the start junction of the link\", start_junction );\r\n    this.end_junction = new Property( \"End Junction Name\", \"The road name of the end junction of the link\", end_junction );\r\n    this.counts = {};\r\n}\r\n\r\nfunction Count({ parent, year, method, sum_motor_vehicles, sum_hgvs, sum_bus_coach, sum_cars_taxis, sum_lgvs, hgvs: { sum_hgv_2_rigid, sum_hgv_3_artic, sum_hgv_3_rigid, sum_hgv_4_rigid, sum_hgv_5_artic, sum_hgv_6_artic }, twowheels: { push, motor } }) {\r\n    this.parent = parent;\r\n    this.year = new Property( \"AADF Year\", \"AADFs are shown for each year from 2000 onwards\", year );\r\n    this.isEstimated = new Property( \"Is Estimated?\", \"Sometimes the vehicle count is estimated\", method === \"Estimated\" );\r\n    this.vehicle_counts = d3.hierarchy( {\r\n        name: \"Total Vehicles\",\r\n        value: sum_motor_vehicles,\r\n        children: [\r\n            new Property( \"HGVs\", \"\", sum_hgvs, [\r\n                new Property( \"Two-rigid axle HGVs\", \"\", sum_hgv_2_rigid ),\r\n                new Property( \"Three-articulated axle HGVs\", \"\", sum_hgv_3_artic ),\r\n                new Property( \"Three-rigid axle HGVs\", \"\", sum_hgv_3_rigid ),\r\n                new Property( \"Four-rigid axle HGVs\", \"\", sum_hgv_4_rigid ),\r\n                new Property( \"Five-articulated axle HGVs\", \"\", sum_hgv_5_artic ),\r\n                new Property( \"Six-articulated axle HGVs\", \"\", sum_hgv_6_artic ),\r\n            ]),\r\n            new Property( \"Two-Wheeled Vehicles\", \"\", push + motor, [\r\n                new Property( \"Pedal Cycles\", \"\", push ),\r\n                new Property( \"Two-Wheeled Motor Vehicles\", \"\", motor ),\r\n            ]),\r\n            new Property( \"Buses and Coaches\", \"\", sum_bus_coach ),\r\n            new Property( \"Cars and Taxis\", \"\", sum_cars_taxis ),\r\n            new Property( \"LGVs\", \"\", sum_lgvs )\r\n        ]\r\n    })\r\n}\r\n\r\nfunction Property( name, description, value, children = [] ){\r\n    this.name = name;\r\n    this.description = description;\r\n    this.value = value;\r\n    this.children = children;\r\n}\r\n","import React, { useState, useEffect, useCallback, useRef } from 'react';\nimport { useGesture } from 'react-use-gesture';\nimport Mapbox from './components/js/Mapbox.js';\nimport HierarchicalGraph from './components/js/HierarchicalGraph.js';\nimport { parseData } from './components/js/DataLogic.js';\nimport { useSpring, animated, config } from 'react-spring';\nimport { Spring } from 'react-spring/renderprops';\nimport * as d3 from 'd3';\nimport './App.scss';\n\nexport default function App() {\n\n    const [ data, setData ] = useState( null );\n    const [ currentCP, setCP ] = useState( null );\n    const [ hoveredCP, setHoveredCP ] = useState( null );\n    const [ currentYear, setYear ] = useState( 2000 );\n\n    useEffect( () => {\n\n        d3.json( './devon.json' )\n            .then( result => {\n                    const newData = parseData( result );\n                    setData( newData );\n                    setYear( 2000 );\n                    setCP( null )//Object.values( newData )[0] );\n                }\n            )\n\n    }, [] )\n\n    const memoMap = useCallback( <Mapbox data={data} setHoveredCP={setHoveredCP} setCP={setCP}/>, [data] );\n\n    return (\n        <div className=\"App\">\n            <header className=\"App_header\">\n                <h1>Devon Annual Average Daily Flows (AADFs)</h1>\n            </header>\n            <div className=\"App_frames\">\n                <AppFrame vspan={2}>\n                    {memoMap}\n                </AppFrame>\n                <AppFrame>\n                    <HierarchicalGraph data={data} currentCP={currentCP} currentYear={currentYear} setHoveredCP={setHoveredCP}/>\n                </AppFrame>\n                <AppFrame>\n                    <Readout data={data}/>\n                </AppFrame>\n            </div>\n        </div>\n    );\n}\n\nconst AppFrame = ({ children, vspan = 1, hspan = 1 }) => {\n\n    const [ width, setWidth ] = useState( 50 );\n    const [ maximised, _setMaximised ] = useState( false );\n    const [ style, setStyle ] = useSpring( () => ({ left: 0, top: 0, position: \"absolute\", config: config.stiff }) );\n\n    const onResize = () => {\n        setWidth( window.innerWidth < 800 ? 100 : 50 );\n    }\n\n    const childrenRef = useRef( null )\n\n    useEffect( () => {\n        window.addEventListener( \"resize\", onResize );\n        return () => window.removeEventListener( \"resize\", onResize )\n    }, [] )\n\n    const setMaximised = val => {\n\n        _setMaximised( val );\n        const { left, top } = childrenRef.current.parentNode.getBoundingClientRect();\n        console.log( val )\n        setStyle({\n            from:{\n                left: val ? left : 0,\n                top: val ? top : 0,\n                position: \"fixed\"\n            },\n            to: {\n                left: val ? 0 : left,\n                top: val ? 0 : top,\n            },\n            onRest: () => style.position.value = val ? \"fixed\" : \"absolute\"\n\n        })\n\n\n\n    }\n\n    return (\n        <div className=\"App_frame\" style={{minWidth: \"400px\", height: 50*vspan + \"%\", width: width + \"%\"}}>\n            <div id=\"layoutPlaceholder\" style={{width: \"100%\", height: \"100%\"}}/>\n            <animated.div ref={childrenRef} className={`App_frame_children${ maximised ? ' fullscreen' : ''}`} style={style}>\n                {children}\n            </animated.div>\n            <MaximiseButton maximised={maximised} setMaximised={setMaximised}/>\n        </div>\n    )\n}\n\nconst MaximiseButton = ({ maximised, setMaximised }) => {\n\n    const [ blend, setBlend ] = useState( 0 );\n    const path = useRef( null );\n\n    const bind = useGesture( {\n        onHover: ({hovering}) => { setBlend( hovering ? 1 : 0 ) },\n        onDragStart: () => setMaximised( !maximised )\n    })\n\n    const pathInterp = useCallback(\n        d3.interpolateString( `\n            M -10 0\n            L 0 0\n            L 0 10\n            M 0 10\n            L 0 0\n            L 10 0\n            M 10 0\n            L 0 0\n            L 0 -10\n            M 0 -10\n            L 0 0\n            L -10 0\n            `,\n            `\n            M -10 2\n            L -10 10\n            L -2 10\n            M 2 10\n            L 10 10\n            L 10 2\n            M 10 -2\n            L 10 -10\n            L 2 -10\n            M -2 -10\n            L -10 -10\n            L -10 -2\n        `)\n    , [] )\n\n    return (\n        <div className=\"Maximise_Button\">\n            <svg viewBox=\"0 0 30 30\">\n                <rect x=\"0\" y=\"0\" width=\"100%\" height=\"100%\" {...bind()}/>\n                <Spring from={{ t: blend === 0 ? 1 : 0 }} to={{ t: blend }} config={{ tension: 360, friction: 24 }}>\n                    {({ t }) => <path ref={path} d={pathInterp( t )} transform=\"translate(15,15)\"/>}\n                </Spring>\n            </svg>\n        </div>\n    )\n\n}\n\nconst Readout = ({ data }) => {\n\n    useEffect( () => {\n    }, [data])\n\n    return (\n        <div className=\"Readout\">\n\n        </div>\n    )\n}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}